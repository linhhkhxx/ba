<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nhà Xe Thăng Long - Dịch Vụ Xe Khách Uy Tín</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1e40af;
        --primary-light: #3b82f6;
        --danger-color: #ef4444;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        line-height: 1.6;
        color: var(--gray-900);
        background: #ffffff;
      }

      /* Header */
      header {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        border-bottom: 1px solid var(--gray-200);
      }

      .top-bar {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        padding: 8px 0;
        font-size: 13px;
      }

      .top-bar .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .contact-info {
        display: flex;
        gap: 24px;
        align-items: center;
      }

      .contact-info span {
        display: flex;
        align-items: center;
        gap: 6px;
        opacity: 0.95;
      }

      .user-actions {
        display: flex;
        gap: 8px;
      }

      .user-actions a {
        color: white;
        text-decoration: none;
        padding: 6px 16px;
        border-radius: 6px;
        transition: all 0.3s;
        font-weight: 500;
        cursor: pointer;
      }

      .user-actions a:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .main-nav {
        max-width: 1280px;
        margin: 0 auto;
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 800;
        color: white;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .logo-text h1 {
        font-size: 22px;
        font-weight: 700;
        color: var(--gray-900);
        letter-spacing: -0.5px;
      }

      .logo-text p {
        font-size: 12px;
        color: var(--gray-600);
        font-weight: 500;
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 8px;
      }

      nav a {
        color: var(--gray-700);
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
        padding: 10px 18px;
        border-radius: 8px;
        transition: all 0.3s;
        cursor: pointer;
      }

      nav a:hover {
        background: var(--gray-50);
        color: var(--primary-color);
      }

      .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray-700);
      }

      /* Hero Section */
      .hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
        padding: 120px 24px 180px;
      }

      .hero::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(255, 255, 255, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(255, 255, 255, 0.1) 0%,
            transparent 50%
          );
      }

      .hero-content {
        max-width: 1280px;
        margin: 0 auto;
        text-align: center;
        position: relative;
        z-index: 1;
      }

      .hero h2 {
        font-size: 56px;
        font-weight: 800;
        color: white;
        margin-bottom: 24px;
        line-height: 1.1;
        letter-spacing: -1px;
        animation: fadeInUp 0.8s ease-out;
      }

      .hero p {
        font-size: 20px;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 48px;
        font-weight: 400;
        animation: fadeInUp 0.8s ease-out 0.2s both;
      }

      .hero-badges {
        display: flex;
        justify-content: center;
        gap: 32px;
        margin-top: 40px;
        animation: fadeInUp 0.8s ease-out 0.4s both;
      }

      .hero-badge {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        padding: 16px 28px;
        border-radius: 12px;
        color: white;
        font-weight: 600;
        font-size: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Booking Section */
      .booking-section {
        max-width: 1100px;
        margin: -100px auto 0;
        padding: 0 24px 80px;
        position: relative;
        z-index: 10;
      }

      .booking-card {
        background: white;
        padding: 48px;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1),
          0 0 0 1px rgba(0, 0, 0, 0.05);
      }

      .booking-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--gray-900);
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .form-group label .required {
        color: var(--danger-color);
      }

      .form-group input,
      .form-group select {
        padding: 14px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.3s;
        background: white;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
      }

      .search-btn {
        grid-column: 1 / -1;
        padding: 16px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 12px;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
      }

      /* Results Section */
      .results-section {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 24px 80px;
        display: none;
      }

      .results-section.show {
        display: block;
      }

      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        flex-wrap: wrap;
        gap: 16px;
      }

      .results-info h3 {
        font-size: 20px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 4px;
      }

      .results-count {
        font-size: 14px;
        color: var(--gray-600);
      }

      .results-filters {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 8px 16px;
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: var(--gray-700);
      }

      .filter-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .filter-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
      }

      .sort-select {
        padding: 8px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
      }

      .sort-select:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      /* Trip Cards */
      .trips-grid {
        display: grid;
        gap: 20px;
      }

      .trip-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .trip-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: var(--primary-light);
        transform: translateY(-2px);
      }

      .trip-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        gap: 16px;
      }

      .trip-type {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        white-space: nowrap;
      }

      .trip-type.bus {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        color: #1e40af;
      }

      .trip-type.limousine {
        background: linear-gradient(135deg, #fce7f3, #fbcfe8);
        color: #9f1239;
      }

      .trip-price {
        text-align: right;
      }

      .price-amount {
        font-size: 28px;
        font-weight: 800;
        color: var(--primary-color);
        line-height: 1;
      }

      .price-label {
        font-size: 12px;
        color: var(--gray-600);
        margin-top: 4px;
      }

      .trip-route {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 20px;
      }

      .route-location {
        flex: 1;
      }

      .location-label {
        font-size: 12px;
        color: var(--gray-600);
        margin-bottom: 4px;
      }

      .location-name {
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
      }

      .route-arrow {
        font-size: 24px;
        color: var(--gray-400);
        flex-shrink: 0;
      }

      .trip-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        padding-top: 20px;
        border-top: 1px solid var(--gray-200);
      }

      .trip-detail {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .detail-icon {
        width: 40px;
        height: 40px;
        background: var(--gray-100);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
      }

      .detail-info {
        flex: 1;
        min-width: 0;
      }

      .detail-label {
        font-size: 12px;
        color: var(--gray-600);
      }

      .detail-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .trip-actions {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      .btn-book {
        flex: 1;
        padding: 14px 24px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-book:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
      }

      /* Loading State */
      .loading-state {
        text-align: center;
        padding: 60px 24px;
        display: none;
      }

      .loading-state.show {
        display: block;
      }

      .spinner {
        width: 48px;
        height: 48px;
        border: 4px solid var(--gray-200);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: 16px;
        color: var(--gray-600);
        font-weight: 500;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 80px 24px;
        display: none;
      }

      .empty-state.show {
        display: block;
      }

      .empty-icon {
        width: 120px;
        height: 120px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        margin: 0 auto 24px;
      }

      .empty-state h3 {
        font-size: 24px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .empty-state p {
        font-size: 16px;
        color: var(--gray-600);
        max-width: 400px;
        margin: 0 auto;
      }

      /* Badge */
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-success {
        background: #dcfce7;
        color: #166534;
      }

      .badge-warning {
        background: #fef3c7;
        color: #92400e;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(17, 24, 39, 0.7);
        backdrop-filter: blur(8px);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        padding: 24px;
        animation: fadeIn 0.3s ease-out;
      }

      .modal.show {
        display: flex;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .modal-content {
        background: white;
        padding: 36px 40px;
        border-radius: 24px;
        max-width: 480px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        position: relative;
        animation: slideUp 0.3s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        text-align: center;
        margin-bottom: 28px;
      }

      .modal-icon {
        width: 72px;
        height: 72px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 32px;
        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
      }

      .modal-header h2 {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 8px;
      }

      .modal-header p {
        color: var(--gray-600);
        font-size: 14px;
      }

      .close-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--gray-100);
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        color: var(--gray-600);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .close-modal:hover {
        background: var(--gray-200);
        color: var(--gray-900);
      }

      .auth-form .form-group {
        margin-bottom: 24px;
      }

      .auth-form .form-group:last-of-type {
        margin-bottom: 8px;
      }

      .auth-form label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--gray-900);
        font-size: 14px;
      }

      .auth-form input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.3s;
      }

      .auth-form input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
      }

      .auth-form input.error {
        border-color: var(--danger-color);
      }

      .password-toggle-group {
        position: relative;
      }

      .password-toggle-group input {
        padding-right: 48px !important;
      }

      .password-toggle-btn {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        padding: 8px;
        color: var(--gray-500);
        transition: color 0.3s;
        z-index: 10;
      }

      .password-toggle-btn:hover {
        color: var(--gray-700);
      }

      .password-strength {
        height: 4px;
        background: var(--gray-200);
        border-radius: 2px;
        margin-top: 8px;
        overflow: hidden;
      }

      .password-strength-bar {
        height: 100%;
        width: 0;
        transition: all 0.3s;
        border-radius: 2px;
      }

      .password-strength-bar.weak {
        width: 33%;
        background: var(--danger-color);
      }

      .password-strength-bar.medium {
        width: 66%;
        background: var(--warning-color);
      }

      .password-strength-bar.strong {
        width: 100%;
        background: var(--success-color);
      }

      .password-strength-text {
        font-size: 12px;
        margin-top: 4px;
        color: var(--gray-600);
      }

      .error-message {
        color: var(--danger-color);
        font-size: 13px;
        margin-top: 6px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin: 20px 0;
      }

      .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        margin-top: 2px;
        flex-shrink: 0;
      }

      .checkbox-group label {
        margin: 0;
        font-weight: normal;
        font-size: 14px;
        cursor: pointer;
        line-height: 1.5;
        color: var(--gray-700);
      }

      .submit-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .submit-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
      }

      .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-primary {
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 24px 0;
        color: var(--gray-500);
        font-size: 14px;
      }

      .divider::before,
      .divider::after {
        content: "";
        flex: 1;
        border-bottom: 1px solid var(--gray-300);
      }

      .divider span {
        padding: 0 16px;
      }

      .switch-auth {
        text-align: center;
        margin-top: 24px;
        font-size: 14px;
        color: var(--gray-600);
      }

      .switch-auth a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
      }

      .switch-auth a:hover {
        text-decoration: underline;
      }

      .forgot-password {
        text-align: right;
        margin-top: 8px;
      }

      .forgot-password a {
        color: var(--primary-color);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
      }

      .forgot-password a:hover {
        text-decoration: underline;
      }

      .alert {
        padding: 14px 16px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
        align-items: center;
        gap: 10px;
        animation: slideDown 0.3s ease-out;
      }

      .alert.show {
        display: flex;
      }

      .alert-error {
        background: #fef2f2;
        color: #991b1b;
        border: 1px solid #fecaca;
      }

      .alert-success {
        background: #f0fdf4;
        color: #166534;
        border: 1px solid #bbf7d0;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: white;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
      }

      .user-name {
        font-weight: 600;
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .account-settings-btn {
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        margin-left: 8px;
        position: relative;
      }

      .account-settings-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Settings Dropdown Menu */
      .settings-dropdown {
        position: absolute;
        top: 45px;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        min-width: 220px;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s;
        z-index: 1000;
      }

      .settings-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .settings-dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 18px;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--gray-900);
        border-bottom: 1px solid var(--gray-100);
      }

      .settings-dropdown-item:last-child {
        border-bottom: none;
      }

      .settings-dropdown-item:hover {
        background: var(--gray-50);
      }

      .settings-dropdown-item .icon {
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      .settings-dropdown-item .text {
        font-size: 14px;
        font-weight: 500;
      }

      .change-password-btn {
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        margin-left: 8px;
      }

      .change-password-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .text-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
      }

      .text-link:hover {
        text-decoration: underline;
      }

      /* Booking Modal Styles */
      .booking-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(17, 24, 39, 0.8);
        backdrop-filter: blur(8px);
        z-index: 1001;
        overflow-y: auto;
        padding: 24px;
      }

      .booking-modal.show {
        display: block;
      }

      .booking-modal-content {
        background: white;
        max-width: 900px;
        margin: 0 auto;
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: slideUp 0.3s ease-out;
      }

      .booking-modal-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        padding: 24px 32px;
        position: relative;
      }

      .booking-modal-header h2 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .booking-modal-header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .close-booking-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .close-booking-modal:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .booking-modal-body {
        padding: 24px;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }

      .trip-summary {
        background: var(--gray-50);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 24px;
      }

      .trip-summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .trip-summary-row:last-child {
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 2px dashed var(--gray-300);
        margin-top: 4px;
      }

      .trip-summary-label {
        font-size: 13px;
        color: var(--gray-600);
      }

      .trip-summary-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .trip-summary-total {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary-color);
      }

      /* Seat Selection */
      .seat-selection-container {
        margin-bottom: 24px;
      }

      .seat-selection-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .seat-selection-header h3 {
        font-size: 16px;
        font-weight: 700;
        color: var(--gray-900);
      }

      .seats-selected {
        font-size: 13px;
        color: var(--gray-600);
      }

      .seats-selected strong {
        color: var(--primary-color);
        font-weight: 700;
      }

      .seat-legend {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--gray-700);
      }

      .legend-box {
        width: 24px;
        height: 24px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
      }

      .legend-box.available {
        background: white;
        border: 2px solid var(--gray-300);
        color: var(--gray-700);
      }

      .legend-box.selected {
        background: var(--primary-color);
        border: 2px solid var(--primary-color);
        color: white;
      }

      .legend-box.occupied {
        background: var(--gray-300);
        border: 2px solid var(--gray-300);
        color: var(--gray-600);
        cursor: not-allowed;
      }

      .bus-layout {
        background: var(--gray-100);
        padding: 16px;
        border-radius: 12px;
        border: 2px solid var(--gray-200);
      }

      .driver-section {
        text-align: right;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 2px dashed var(--gray-300);
      }

      .driver-icon {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: var(--gray-700);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }

      .seats-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        max-width: 350px;
        margin: 0 auto;
      }

      .seat {
        aspect-ratio: 1;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
      }

      .seat.available {
        background: white;
        border-color: var(--gray-300);
        color: var(--gray-700);
      }

      .seat.available:hover {
        border-color: var(--primary-color);
        transform: scale(1.05);
      }

      .seat.selected {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: scale(1.05);
      }

      .seat.occupied {
        background: var(--gray-300);
        border-color: var(--gray-300);
        color: var(--gray-600);
        cursor: not-allowed;
        opacity: 0.6;
      }

      .seat.aisle {
        background: transparent;
        border: none;
        cursor: default;
      }

      /* Passenger Info Form */
      .passenger-info-container {
        margin-bottom: 24px;
      }

      .passenger-info-container h3 {
        font-size: 16px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 16px;
      }

      .passenger-form {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .passenger-form .form-group {
        margin-bottom: 0;
      }

      .passenger-form .form-group.full-width {
        grid-column: 1 / -1;
      }

      .passenger-form .form-group label {
        font-size: 13px;
        margin-bottom: 6px;
      }

      .passenger-form .form-group input {
        padding: 10px 12px;
        font-size: 14px;
      }

      /* Payment Method */
      .payment-method-container {
        margin-bottom: 24px;
      }

      .payment-method-container h3 {
        font-size: 16px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 16px;
      }

      .payment-methods {
        display: grid;
        gap: 12px;
      }

      .payment-method {
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
        background: white;
      }

      .payment-method:hover {
        border-color: var(--primary-color);
        background: var(--gray-50);
      }

      .payment-method.selected {
        border-color: var(--primary-color);
        background: linear-gradient(
          135deg,
          rgba(37, 99, 235, 0.05),
          rgba(59, 130, 246, 0.05)
        );
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .payment-radio {
        width: 20px;
        height: 20px;
        border: 2px solid var(--gray-300);
        border-radius: 50%;
        flex-shrink: 0;
        position: relative;
        transition: all 0.3s;
      }

      .payment-method.selected .payment-radio {
        border-color: var(--primary-color);
      }

      .payment-method.selected .payment-radio::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 10px;
        height: 10px;
        background: var(--primary-color);
        border-radius: 50%;
      }

      .payment-icon {
        width: 40px;
        height: 40px;
        background: var(--gray-100);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
      }

      .payment-method.selected .payment-icon {
        background: var(--primary-color);
        color: white;
      }

      .payment-info {
        flex: 1;
      }

      .payment-name {
        font-size: 15px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 2px;
      }

      .payment-desc {
        font-size: 12px;
        color: var(--gray-600);
      }

      .payment-badge {
        background: var(--success-color);
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        flex-shrink: 0;
      }

      .payment-note {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
        display: none;
      }

      .payment-note.show {
        display: block;
      }

      .payment-note p {
        font-size: 13px;
        color: var(--gray-700);
        line-height: 1.5;
        margin: 0;
      }

      .payment-note strong {
        color: var(--gray-900);
      }

      .confirm-booking-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        margin-top: 8px;
      }

      .confirm-booking-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
      }

      .confirm-booking-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* Login Required Modal */
      .login-required-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(17, 24, 39, 0.8);
        backdrop-filter: blur(8px);
        z-index: 1002;
        justify-content: center;
        align-items: center;
        padding: 24px;
      }

      .login-required-modal.show {
        display: flex;
      }

      .login-required-content {
        background: white;
        max-width: 440px;
        width: 100%;
        border-radius: 24px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: slideUp 0.3s ease-out;
      }

      .login-required-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        margin: 0 auto 24px;
      }

      .login-required-content h2 {
        font-size: 24px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .login-required-content p {
        font-size: 15px;
        color: var(--gray-600);
        line-height: 1.6;
        margin-bottom: 32px;
      }

      .login-required-actions {
        display: flex;
        gap: 12px;
      }

      .btn-login-now {
        flex: 1;
        padding: 14px 24px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .btn-login-now:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
      }

      .btn-cancel {
        flex: 1;
        padding: 14px 24px;
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-cancel:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      /* Booking Success Modal */
      /* Booking Review Modal */
      .booking-review-content {
        margin: 24px 0;
      }

      .review-section {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        text-align: left;
      }

      .review-section h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .review-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid var(--gray-200);
      }

      .review-row:last-child {
        border-bottom: none;
      }

      .review-label {
        color: var(--gray-600);
        font-size: 14px;
      }

      .review-value {
        color: var(--gray-900);
        font-weight: 600;
        font-size: 14px;
        text-align: right;
      }

      .review-total {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        margin-top: 16px;
      }

      .review-total .review-row {
        border-bottom: none;
      }

      .review-total .review-label,
      .review-total .review-value {
        color: white;
        font-size: 16px;
        font-weight: 700;
      }

      /* QR Code Section */
      .qr-code-section {
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        border: 2px solid var(--primary-color);
        border-radius: 16px;
        padding: 24px;
        margin-top: 20px;
        text-align: center;
      }

      .qr-code-section h3 {
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .qr-description {
        font-size: 14px;
        color: var(--gray-600);
        margin-bottom: 20px;
      }

      .qr-code-container {
        display: inline-block;
        padding: 16px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 16px;
      }

      .qr-code-container canvas,
      .qr-code-container img {
        display: block;
        border-radius: 8px;
      }

      .booking-id-text {
        font-size: 14px;
        color: var(--gray-700);
        margin-top: 12px;
        padding: 10px 16px;
        background: white;
        border-radius: 8px;
        display: inline-block;
      }

      .booking-id-text strong {
        color: var(--primary-color);
        font-weight: 700;
      }

      .booking-review-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
      }

      .btn-secondary {
        flex: 1;
        padding: 14px 24px;
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-secondary:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      /* My Bookings Styles */
      .my-bookings-container {
        margin: 24px 0;
      }

      .bookings-tabs {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
        border-bottom: 2px solid var(--gray-200);
      }

      .booking-tab {
        padding: 12px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--gray-600);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: -2px;
      }

      .booking-tab:hover {
        color: var(--primary-color);
      }

      .booking-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
      }

      .booking-card {
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
        transition: all 0.3s;
      }

      .booking-card:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
      }

      .booking-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--gray-200);
      }

      .booking-id {
        font-size: 18px;
        font-weight: 700;
        color: var(--gray-900);
      }

      .booking-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
      }

      .booking-status.confirmed {
        background: #d1fae5;
        color: #065f46;
      }

      .booking-status.upcoming {
        background: #fef3c7;
        color: #92400e;
      }

      .booking-status.completed {
        background: #dbeafe;
        color: #1e40af;
      }

      .booking-status.cancelled {
        background: #fee2e2;
        color: #991b1b;
      }

      .booking-card-body {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }

      .booking-info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .booking-info-label {
        font-size: 13px;
        color: var(--gray-600);
      }

      .booking-info-value {
        font-size: 15px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .booking-route {
        font-size: 16px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 8px;
      }

      .booking-card-footer {
        display: flex;
        gap: 12px;
        padding-top: 16px;
        border-top: 1px solid var(--gray-200);
      }

      .btn-detail {
        flex: 1;
        padding: 10px 16px;
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-detail:hover {
        background: var(--primary-color);
        color: white;
      }

      .btn-cancel {
        flex: 1;
        padding: 10px 16px;
        background: white;
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-cancel:hover {
        background: var(--danger-color);
        color: white;
      }

      .empty-bookings {
        text-align: center;
        padding: 60px 20px;
      }

      .empty-bookings-icon {
        font-size: 64px;
        margin-bottom: 16px;
      }

      .empty-bookings h3 {
        font-size: 20px;
        color: var(--gray-900);
        margin-bottom: 8px;
      }

      .empty-bookings p {
        color: var(--gray-600);
        margin-bottom: 24px;
      }

      /* My Tickets Section */
      .my-tickets-section {
        padding: 80px 0;
        background: var(--gray-50);
      }

      .my-tickets-content {
        margin-top: 40px;
      }

      .tickets-tabs {
        display: flex;
        gap: 16px;
        margin-bottom: 32px;
        border-bottom: 3px solid var(--gray-200);
      }

      .ticket-tab {
        padding: 14px 28px;
        background: none;
        border: none;
        border-bottom: 4px solid transparent;
        color: var(--gray-600);
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: -3px;
      }

      .ticket-tab:hover {
        color: var(--primary-color);
        background: rgba(37, 99, 235, 0.05);
      }

      .ticket-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
        background: rgba(37, 99, 235, 0.08);
      }

      .tickets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 24px;
      }

      .ticket-card {
        background: white;
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .ticket-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15);
        border-color: var(--primary-color);
      }

      .ticket-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
      }

      .ticket-id {
        font-size: 20px;
        font-weight: 700;
        color: var(--gray-900);
      }

      .ticket-date {
        font-size: 12px;
        color: var(--gray-500);
        margin-top: 4px;
      }

      .ticket-route {
        font-size: 18px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .ticket-info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 16px;
      }

      .ticket-info-item {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .ticket-info-label {
        font-size: 13px;
        color: var(--gray-600);
        font-weight: 500;
      }

      .ticket-info-value {
        font-size: 15px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .ticket-price {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        padding: 12px 16px;
        border-radius: 12px;
        margin: 16px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .ticket-price-label {
        font-size: 14px;
        font-weight: 500;
      }

      .ticket-price-value {
        font-size: 20px;
        font-weight: 700;
      }

      .ticket-actions {
        display: flex;
        gap: 12px;
      }

      .ticket-actions button {
        flex: 1;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .ticket-btn-detail {
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
      }

      .ticket-btn-detail:hover {
        background: var(--primary-color);
        color: white;
      }

      .ticket-btn-track {
        background: white;
        color: #10b981;
        border: 2px solid #10b981;
      }

      .ticket-btn-track:hover {
        background: #10b981;
        color: white;
      }

      .ticket-btn-cancel {
        background: white;
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
      }

      .ticket-btn-cancel:hover {
        background: var(--danger-color);
        color: white;
      }

      .empty-tickets {
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: 20px;
        grid-column: 1 / -1;
      }

      .empty-tickets-icon {
        font-size: 80px;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-tickets h3 {
        font-size: 24px;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .empty-tickets p {
        color: var(--gray-600);
        font-size: 16px;
        margin-bottom: 28px;
      }

      .empty-tickets .btn-primary {
        display: inline-block;
        text-decoration: none;
      }

      /* Cannot Cancel Warning Modal */
      .cannot-cancel-content {
        text-align: center;
        padding: 20px;
      }

      .warning-icon-large {
        margin: 0 auto 24px;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.9; }
      }

      .warning-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .warning-message {
        font-size: 16px;
        color: var(--gray-600);
        margin-bottom: 24px;
        line-height: 1.6;
      }

      .cannot-cancel-info {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: left;
      }

      .info-box {
        background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
        border-left: 4px solid #F59E0B;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 24px;
        display: flex;
        gap: 12px;
        text-align: left;
      }

      .info-box-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .info-box-content {
        flex: 1;
      }

      .info-box-content strong {
        color: #92400E;
        display: block;
        margin-bottom: 4px;
        font-size: 15px;
      }

      .info-box-content p {
        color: #78350F;
        margin: 0;
        font-size: 14px;
        line-height: 1.5;
      }

      .info-box-content strong:last-child {
        color: #B45309;
      }

      .warning-actions {
        display: flex;
        justify-content: center;
      }

      .btn-warning-ok {
        padding: 14px 48px;
        background: var(--primary-color);
        color: white;
        border: 2px solid var(--primary-color);
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 200px;
      }

      .btn-warning-ok:hover {
        background: #1D4ED8;
      }

      /* Logout Modal Styles */
      .logout-modal-content {
        text-align: center;
        padding: 20px;
      }

      .logout-icon {
        display: flex;
        justify-content: center;
        margin-bottom: 24px;
        animation: scaleIn 0.5s ease-out;
      }

      .logout-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .logout-message {
        font-size: 16px;
        color: var(--gray-600);
        margin-bottom: 32px;
        line-height: 1.6;
      }

      .logout-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .btn-logout-cancel,
      .btn-logout-confirm {
        padding: 14px 32px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        min-width: 140px;
      }

      .btn-logout-cancel {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
      }

      .btn-logout-cancel:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      .btn-logout-confirm {
        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
      }

      .btn-logout-confirm:hover {
        background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
      }

      /* Cancel Confirmation Modal */
      .cancel-confirm-content {
        text-align: center;
        padding: 20px;
      }

      .cancel-icon {
        margin: 0 auto 24px;
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
      }

      .cancel-title {
        font-size: 26px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .cancel-message {
        font-size: 16px;
        color: var(--gray-600);
        margin-bottom: 24px;
      }

      .cancel-info {
        background: var(--gray-50);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: left;
      }

      .cancel-info-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid var(--gray-200);
      }

      .cancel-info-row:last-child {
        border-bottom: none;
      }

      .cancel-info-label {
        color: var(--gray-600);
        font-size: 14px;
      }

      .cancel-info-value {
        color: var(--gray-900);
        font-weight: 600;
        font-size: 14px;
      }

      .cancel-warning {
        background: #FEF2F2;
        border: 1px solid #FEE2E2;
        border-radius: 10px;
        padding: 12px 16px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #991B1B;
        font-size: 14px;
        font-weight: 500;
      }

      .warning-icon {
        font-size: 20px;
      }

      .cancel-actions {
        display: flex;
        gap: 12px;
      }

      .btn-cancel-no {
        flex: 1;
        padding: 14px 24px;
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-cancel-no:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      .btn-cancel-yes {
        flex: 1;
        padding: 14px 24px;
        background: var(--danger-color);
        color: white;
        border: 2px solid var(--danger-color);
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-cancel-yes:hover {
        background: #DC2626;
        border-color: #DC2626;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      /* Cancel Success Modal */
      .cancel-success-content {
        text-align: center;
        padding: 20px;
      }

      .success-icon {
        margin: 0 auto 24px;
        animation: scaleIn 0.5s ease-out;
      }

      @keyframes scaleIn {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
      }

      @keyframes scaleOut {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(0.8); opacity: 0; }
      }

      @keyframes fadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; }
      }

      .success-title {
        font-size: 26px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .success-message {
        font-size: 16px;
        color: var(--gray-600);
        margin-bottom: 32px;
        line-height: 1.6;
      }

      .success-actions {
        display: flex;
        justify-content: center;
      }

      .btn-success-ok {
        padding: 14px 48px;
        background: var(--primary-color);
        color: white;
        border: 2px solid var(--primary-color);
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 200px;
      }

      .btn-success-ok:hover {
        background: #1D4ED8;
        border-color: #1D4ED8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .booking-success-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(17, 24, 39, 0.8);
        backdrop-filter: blur(8px);
        z-index: 1003;
        justify-content: center;
        align-items: center;
        padding: 24px;
        animation: fadeIn 0.3s ease-out;
      }

      .booking-success-modal.show {
        display: flex;
      }

      .booking-success-content {
        background: white;
        max-width: 520px;
        width: 100%;
        border-radius: 24px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: slideUp 0.3s ease-out;
        max-height: 90vh;
        overflow-y: auto;
      }

      .success-icon-wrapper {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #10b981, #059669);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
        animation: scaleIn 0.5s ease-out;
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
      }

      .success-icon-wrapper .checkmark {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: block;
        stroke-width: 3;
        stroke: #fff;
        stroke-miterlimit: 10;
        animation: checkmark 0.8s ease-out 0.2s;
      }

      @keyframes scaleIn {
        from {
          transform: scale(0);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes checkmark {
        0% {
          stroke-dashoffset: 100;
        }
        100% {
          stroke-dashoffset: 0;
        }
      }

      .booking-success-content h2 {
        font-size: 28px;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 12px;
      }

      .booking-success-content .subtitle {
        font-size: 15px;
        color: var(--gray-600);
        margin-bottom: 32px;
      }

      .booking-details {
        background: var(--gray-50);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        text-align: left;
      }

      .booking-detail-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 12px 0;
        border-bottom: 1px solid var(--gray-200);
      }

      .booking-detail-row:last-child {
        border-bottom: none;
      }

      .booking-detail-label {
        font-size: 14px;
        color: var(--gray-600);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .booking-detail-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-900);
        text-align: right;
      }

      .booking-detail-value.highlight {
        color: var(--primary-color);
        font-size: 18px;
      }

      .booking-notice {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        border-left: 4px solid var(--primary-color);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 24px;
      }

      .booking-notice p {
        font-size: 14px;
        color: #1e40af;
        margin: 0;
        line-height: 1.6;
      }

      .booking-success-actions {
        display: flex;
        gap: 12px;
      }

      .btn-view-booking {
        flex: 1;
        padding: 14px 24px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .btn-view-booking:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
      }

      .btn-close-success {
        flex: 1;
        padding: 14px 24px;
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-close-success:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      /* Features Section */

      /* Features Section */
      .section {
        padding: 100px 24px;
      }

      .section-alt {
        background: var(--gray-50);
      }

      .container {
        max-width: 1280px;
        margin: 0 auto;
      }

      .section-header {
        text-align: center;
        margin-bottom: 64px;
      }

      .section-label {
        display: inline-block;
        padding: 8px 16px;
        background: linear-gradient(
          135deg,
          rgba(37, 99, 235, 0.1),
          rgba(59, 130, 246, 0.1)
        );
        color: var(--primary-color);
        border-radius: 8px;
        font-size: 13px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        margin-bottom: 16px;
      }

      .section-header h2 {
        font-size: 42px;
        font-weight: 800;
        color: var(--gray-900);
        margin-bottom: 16px;
        letter-spacing: -1px;
      }

      .section-header p {
        font-size: 18px;
        color: var(--gray-600);
        max-width: 600px;
        margin: 0 auto;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 32px;
      }

      .feature-card {
        background: white;
        padding: 40px 32px;
        border-radius: 20px;
        border: 1px solid var(--gray-200);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .feature-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        border-color: var(--primary-color);
      }

      .feature-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(
          135deg,
          rgba(37, 99, 235, 0.1),
          rgba(59, 130, 246, 0.1)
        );
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 24px;
        font-size: 28px;
      }

      .feature-card h3 {
        color: var(--gray-900);
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 12px;
      }

      .feature-card p {
        color: var(--gray-600);
        font-size: 15px;
        line-height: 1.7;
      }

      /* Footer */
      footer {
        background: var(--gray-900);
        color: white;
        padding: 80px 24px 32px;
      }

      .footer-content {
        max-width: 1280px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 64px;
        margin-bottom: 48px;
      }

      .footer-section h3 {
        font-size: 18px;
        margin-bottom: 24px;
        font-weight: 700;
        color: white;
      }

      .footer-section p {
        color: var(--gray-400);
        line-height: 1.7;
        font-size: 14px;
        margin-bottom: 24px;
      }

      .footer-section ul {
        list-style: none;
      }

      .footer-section ul li {
        padding: 8px 0;
      }

      .footer-section a {
        color: var(--gray-400);
        text-decoration: none;
        transition: color 0.3s;
        font-size: 14px;
      }

      .footer-section a:hover {
        color: white;
      }

      .footer-bottom {
        text-align: center;
        padding-top: 32px;
        border-top: 1px solid var(--gray-800);
        color: var(--gray-400);
        font-size: 14px;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .footer-content {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .hero h2 {
          font-size: 36px;
        }

        .hero p {
          font-size: 16px;
        }

        .hero-badges {
          flex-direction: column;
          gap: 12px;
        }

        .booking-card {
          padding: 32px 24px;
        }

        .section-header h2 {
          font-size: 32px;
        }

        .features-grid {
          grid-template-columns: 1fr;
        }

        .results-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .results-filters {
          width: 100%;
        }

        .filter-btn,
        .sort-select {
          flex: 1;
        }

        .trip-header {
          flex-direction: column;
        }

        .trip-price {
          text-align: left;
          align-self: flex-start;
        }

        .trip-route {
          flex-direction: column;
          gap: 12px;
        }

        .route-arrow {
          transform: rotate(90deg);
        }

        .trip-details {
          grid-template-columns: 1fr;
        }

        .trip-actions {
          flex-direction: column;
        }

        nav {
          display: none;
        }

        nav.show {
          display: block;
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          background: white;
          padding: 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        nav ul {
          flex-direction: column;
          gap: 4px;
        }

        .mobile-menu-btn {
          display: block;
        }

        .top-bar .container {
          flex-direction: column;
          gap: 8px;
          text-align: center;
        }

        .contact-info {
          flex-direction: column;
          gap: 4px;
        }

        .footer-content {
          grid-template-columns: 1fr;
          gap: 40px;
        }

        .modal-content {
          padding: 28px 24px;
          max-width: 95%;
          border-radius: 20px;
        }

        .modal-header h2 {
          font-size: 24px;
        }

        .modal-header p {
          font-size: 13px;
        }

        .user-info {
          flex-wrap: wrap;
          gap: 8px;
        }

        .change-password-btn {
          margin-left: 0;
          margin-top: 8px;
          width: 100%;
        }

        .logout-btn {
          width: 100%;
        }

        .booking-review-actions {
          flex-direction: column;
        }

        .btn-secondary,
        .btn-primary {
          width: 100%;
        }

        .review-section h3 {
          font-size: 15px;
        }

        .review-value {
          max-width: 60%;
          word-break: break-word;
        }

        .booking-card-body {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .booking-card-footer {
          flex-direction: column;
        }

        .btn-detail,
        .btn-cancel {
          width: 100%;
        }

        .bookings-tabs {
          overflow-x: auto;
        }

        .booking-tab {
          white-space: nowrap;
          font-size: 14px;
          padding: 10px 16px;
        }

        .tickets-grid {
          grid-template-columns: 1fr;
        }

        .ticket-tab {
          font-size: 14px;
          padding: 12px 20px;
        }

        .ticket-info-grid {
          grid-template-columns: 1fr;
        }

        .ticket-actions {
          flex-direction: column;
        }

        .cancel-actions {
          flex-direction: column;
        }

        .btn-cancel-no,
        .btn-cancel-yes {
          width: 100%;
        }

        .cancel-title {
          font-size: 22px;
        }
      }

      /* Account Settings Styles */
      .account-settings-section {
        min-height: 100vh;
        padding: 80px 0;
        background: var(--gray-50);
      }

      .settings-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .settings-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .settings-card.danger-card {
        border: 2px solid var(--danger-color);
        background: #fff5f5;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
      }

      .card-header h3 {
        font-size: 20px;
        font-weight: 700;
        color: var(--gray-900);
      }

      .btn-edit {
        background: white;
        color: var(--primary-600);
        border: 2px solid var(--primary-600);
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-edit:hover {
        background: var(--primary-600);
        color: white;
      }

      .settings-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid var(--gray-100);
      }

      .btn-secondary {
        background: white;
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-secondary:hover {
        background: var(--gray-50);
      }

      .btn-danger {
        background: white;
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-danger:hover {
        background: var(--danger-color);
        color: white;
      }

      .security-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid var(--gray-100);
      }

      .security-item:last-child {
        border-bottom: none;
      }

      .security-info h4 {
        font-size: 16px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 4px;
      }

      .security-info p {
        font-size: 14px;
        color: var(--gray-600);
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .settings-card {
          padding: 20px;
        }

        .security-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .security-item button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="top-bar">
        <div class="container">
          <div class="contact-info">
            <span>📞 Hotline: 1900-6789</span>
            <span>✉️ support@thanglong.vn</span>
          </div>
          <div class="user-actions" id="userActions">
            <a onclick="showLoginModal()">Đăng nhập</a>
            <a onclick="showRegisterModal()">Đăng ký</a>
          </div>
        </div>
      </div>
      <div class="main-nav">
        <div class="logo" onclick="window.location.reload()">
          <div class="logo-icon">TL</div>
          <div class="logo-text">
            <h1>Thăng Long Express</h1>
            <p>Nhanh chóng • An toàn • Tiện lợi</p>
          </div>
        </div>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
        <nav id="mainNav">
          <ul>
            <li><a href="#home">Trang chủ</a></li>
            <li><a href="#booking">Đặt vé</a></li>
            <li><a href="#my-tickets" onclick="navigateToMyTickets(); return false;">Vé của tôi</a></li>
            <li><a href="#contact">Liên hệ</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
      <div class="hero-content">
        <h2>Đặt Vé Xe Khách Online<br />Nhanh Chóng & Tiện Lợi</h2>
        <p>
          Trải nghiệm dịch vụ vận chuyển hành khách hàng đầu Việt Nam với công
          nghệ hiện đại
        </p>
        <div class="hero-badges">
          <div class="hero-badge">🚌 Hơn 500 chuyến/ngày</div>
          <div class="hero-badge">⭐ 4.9/5 đánh giá</div>
          <div class="hero-badge">👥 2M+ khách hàng</div>
        </div>
      </div>
    </section>

    <!-- Booking Section -->
    <section class="booking-section" id="booking">
      <div class="booking-card">
        <form class="booking-form" onsubmit="handleBookingSearch(event)">
          <div class="form-group">
            <label>📍 Điểm đi <span class="required">*</span></label>
            <select id="from" required>
              <option value="">Chọn điểm đi</option>
              <option value="hanoi">Hà Nội</option>
              <option value="haiphong">Hải Phòng</option>
              <option value="thaibinh">Thái Bình</option>
              <option value="thanhhoa">Thanh Hóa</option>
              <option value="nghean">Nghệ An</option>
              <option value="hatinh">Hà Tĩnh</option>
            </select>
          </div>
          <div class="form-group">
            <label>📍 Điểm đến <span class="required">*</span></label>
            <select id="to" required>
              <option value="">Chọn điểm đến</option>
              <option value="hanoi">Hà Nội</option>
              <option value="haiphong">Hải Phòng</option>
              <option value="thaibinh">Thái Bình</option>
              <option value="thanhhoa">Thanh Hóa</option>
              <option value="nghean">Nghệ An</option>
              <option value="hatinh">Hà Tĩnh</option>
            </select>
          </div>
          <div class="form-group">
            <label>📅 Ngày đi <span class="required">*</span></label>
            <input type="date" id="date" required />
          </div>
          <div class="form-group">
            <label>👥 Số hành khách</label>
            <input
              type="number"
              id="passengers"
              min="1"
              max="50"
              value="1"
              required
            />
          </div>
          <button type="submit" class="search-btn">🔍 Tìm chuyến xe</button>
        </form>
      </div>
    </section>

    <!-- Results Section -->
    <section class="results-section" id="resultsSection">
      <!-- Results Header -->
      <div class="results-header" id="resultsHeader">
        <div class="results-info">
          <h3 id="routeTitle">Hà Nội → Hải Phòng</h3>
          <p class="results-count">
            Tìm thấy <strong id="tripCount">0</strong> chuyến xe •
            <span id="selectedDate">13/12/2024</span>
          </p>
        </div>
        <div class="results-filters">
          <button
            class="filter-btn active"
            data-filter="all"
            onclick="filterTrips('all')"
          >
            🎫 Tất cả
          </button>
          <button
            class="filter-btn"
            data-filter="bus"
            onclick="filterTrips('bus')"
          >
            🚌 Xe khách
          </button>
          <button
            class="filter-btn"
            data-filter="limousine"
            onclick="filterTrips('limousine')"
          >
            ✨ Limousine
          </button>
          <select class="sort-select" id="sortSelect" onchange="sortTrips()">
            <option value="price-asc">Giá tăng dần</option>
            <option value="price-desc">Giá giảm dần</option>
            <option value="time-asc">Giờ đi sớm nhất</option>
            <option value="time-desc">Giờ đi muộn nhất</option>
          </select>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-state" id="loadingState">
        <div class="spinner"></div>
        <p class="loading-text">Đang tìm kiếm chuyến xe phù hợp...</p>
      </div>

      <!-- No Results State -->
      <div class="empty-state" id="noResultsState">
        <div class="empty-icon">😔</div>
        <h3>Không tìm thấy chuyến xe phù hợp</h3>
        <p>
          Xin lỗi, chúng tôi không tìm thấy chuyến xe nào cho tuyến đường này.
          Vui lòng thử tìm kiếm tuyến khác.
        </p>
      </div>

      <!-- Trips Grid -->
      <div class="trips-grid" id="tripsGrid"></div>
    </section>

    <!-- Features Section -->
    <section class="section section-alt" id="features">
      <div class="container">
        <div class="section-header">
          <span class="section-label">Ưu điểm</span>
          <h2>Tại Sao Chọn Thăng Long?</h2>
          <p>
            Chúng tôi cam kết mang đến trải nghiệm di chuyển tuyệt vời nhất cho
            bạn
          </p>
        </div>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">🎫</div>
            <h3>Đăng ký & Đặt vé Online</h3>
            <p>
              Tạo tài khoản dễ dàng, đăng nhập an toàn. Đặt vé nhanh chóng chỉ
              trong 30 giây với thanh toán đa dạng.
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">🚌</div>
            <h3>Tìm Kiếm Thông Minh</h3>
            <p>
              Tìm chuyến xe phù hợp với bộ lọc thông minh, so sánh giá, xem số
              ghế trống real-time.
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">📋</div>
            <h3>Quản Lý Vé</h3>
            <p>
              Xem lịch sử đặt vé, theo dõi trạng thái, hủy vé linh hoạt. Tất cả
              trong một giao diện duy nhất.
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">💰</div>
            <h3>Giá Tốt Nhất</h3>
            <p>
              Giá vé minh bạch, không phí ẩn. Nhiều chương trình ưu đãi và tích
              điểm đổi quà hấp dẫn.
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">📍</div>
            <h3>Theo Dõi Realtime</h3>
            <p>
              Theo dõi vị trí xe trực tuyến với độ chính xác cao. Nhận thông báo
              tự động về trạng thái chuyến đi.
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">🛡️</div>
            <h3>An Toàn 5 Sao</h3>
            <p>
              Tài xế chuyên nghiệp 10+ năm kinh nghiệm. Bảo hiểm hành khách 200
              triệu/người.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- My Tickets Section -->
    <section id="my-tickets" class="my-tickets-section" style="display: none;">
      <div class="container">
        <div class="section-header" style="position: relative;">
          <div>
            <h2>🎟️ Vé của tôi</h2>
            <p>Quản lý tất cả các vé xe đã đặt</p>
          </div>
          <button onclick="createDemoBookings()" style="position: absolute; top: 0; right: 0; padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">
            🎯 Tạo Vé Demo
          </button>
        </div>

        <div class="my-tickets-content">
          <div class="tickets-tabs">
            <button class="ticket-tab active" onclick="showTicketTab('confirmed')" id="confirmedTicketsTabBtn">
              Đã xác nhận (<span id="confirmedCount">0</span>)
            </button>
            <button class="ticket-tab" onclick="showTicketTab('upcoming')" id="upcomingTicketsTabBtn">
              Sắp tới (<span id="upcomingCount">0</span>)
            </button>
            <button class="ticket-tab" onclick="showTicketTab('completed')" id="completedTicketsTabBtn">
              Đã hoàn thành (<span id="completedCount">0</span>)
            </button>
            <button class="ticket-tab" onclick="showTicketTab('cancelled')" id="cancelledTicketsTabBtn">
              Đã hủy (<span id="cancelledCount">0</span>)
            </button>
          </div>

          <div id="confirmedTicketsContent" class="tickets-grid">
            <!-- Confirmed tickets will be inserted here -->
          </div>

          <div id="upcomingTicketsContent" class="tickets-grid" style="display: none;">
            <!-- Upcoming tickets will be inserted here -->
          </div>

          <div id="completedTicketsContent" class="tickets-grid" style="display: none;">
            <!-- Completed tickets will be inserted here -->
          </div>

          <div id="cancelledTicketsContent" class="tickets-grid" style="display: none;">
            <!-- Cancelled tickets will be inserted here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Account Settings Section -->
    <section id="account-settings" class="account-settings-section" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2>⚙️ Cài đặt tài khoản</h2>
          <p>Quản lý thông tin cá nhân và cài đặt bảo mật</p>
        </div>

        <div class="settings-container">
          <!-- Profile Information Card -->
          <div class="settings-card">
            <div class="card-header">
              <h3>👤 Thông tin cá nhân</h3>
              <button class="btn-edit" id="editProfileBtn" onclick="toggleEditProfile()">✏️ Chỉnh sửa</button>
            </div>

            <div id="profileAlert" class="alert alert-error" style="display: none;">
              <span>⚠️</span>
              <span id="profileAlertMessage"></span>
            </div>

            <form id="profileForm" class="settings-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="profileFullName">Họ và tên</label>
                  <input type="text" id="profileFullName" disabled required />
                  <div class="error-message" id="profileFullNameError"></div>
                </div>

                <div class="form-group">
                  <label for="profileEmail">Email</label>
                  <input type="email" id="profileEmail" disabled required />
                  <div class="error-message" id="profileEmailError"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="profilePhone">Số điện thoại</label>
                  <input type="tel" id="profilePhone" disabled required />
                  <div class="error-message" id="profilePhoneError"></div>
                </div>
              </div>

              <div class="form-actions" id="profileFormActions" style="display: none;">
                <button type="button" class="btn-secondary" onclick="cancelEditProfile()">Hủy</button>
                <button type="submit" class="btn-primary">💾 Lưu thay đổi</button>
              </div>
            </form>
          </div>

          <!-- Security Card -->
          <div class="settings-card">
            <div class="card-header">
              <h3>🔒 Bảo mật</h3>
            </div>

            <div class="security-item">
              <div class="security-info">
                <h4>Mật khẩu</h4>
                <p>Thay đổi mật khẩu để bảo vệ tài khoản của bạn</p>
              </div>
              <button class="btn-secondary" onclick="showChangePasswordModal()">Đổi mật khẩu</button>
            </div>

            <div class="security-item">
              <div class="security-info">
                <h4>Đăng nhập lần cuối</h4>
                <p id="lastLoginTime">Đang tải...</p>
              </div>
            </div>
          </div>

          <!-- Danger Zone Card -->
          <div class="settings-card danger-card">
            <div class="card-header">
              <h3>⚠️ Vùng nguy hiểm</h3>
            </div>

            <div class="security-item">
              <div class="security-info">
                <h4>Xóa tài khoản</h4>
                <p>Xóa vĩnh viễn tài khoản và tất cả dữ liệu của bạn</p>
              </div>
              <button class="btn-danger" onclick="showDeleteAccountConfirm()">Xóa tài khoản</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Thăng Long Express</h3>
          <p>
            Với hơn 15 năm kinh nghiệm, chúng tôi tự hào là đơn vị vận tải hành
            khách hàng đầu Việt Nam, luôn đặt sự hài lòng của khách hàng lên
            hàng đầu.
          </p>
        </div>

        <div class="footer-section">
          <h3>Dịch vụ</h3>
          <ul>
            <li><a href="#booking">Đặt vé online</a></li>
            <li><a href="#">Quản lý vé</a></li>
            <li><a href="#">Theo dõi xe</a></li>
            <li><a href="#">Thuê xe</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h3>Liên hệ</h3>
          <ul>
            <li>📍 123 Đường ABC, Hà Nội</li>
            <li>📞 Hotline: 1900-6789</li>
            <li>✉️ support@thanglong.vn</li>
            <li>🕐 Hỗ trợ 24/7</li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2024 Thăng Long Express. All rights reserved.</p>
      </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('loginModal')">
          ×
        </button>
        <div class="modal-header">
          <div class="modal-icon">👋</div>
          <h2>Chào mừng trở lại!</h2>
          <p>Đăng nhập để tiếp tục đặt vé</p>
        </div>

        <div id="loginAlert" class="alert alert-error">
          <span>⚠️</span>
          <span id="loginAlertMessage"></span>
        </div>

        <form class="auth-form" id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label
              >Email hoặc số điện thoại <span class="required">*</span></label
            >
            <input
              type="text"
              id="loginIdentifier"
              placeholder="VD: user@example.com hoặc 0912345678"
              required
            />
            <div class="error-message" id="loginIdentifierError"></div>
          </div>

          <div class="form-group">
            <label>Mật khẩu <span class="required">*</span></label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="loginPassword"
                placeholder="Nhập mật khẩu"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('loginPassword')"
              >
                👁️
              </button>
            </div>
            <div class="error-message" id="loginPasswordError"></div>
          </div>

          <div class="forgot-password">
            <a onclick="showForgotPasswordModal()">Quên mật khẩu?</a>
          </div>

          <button type="submit" class="submit-btn">Đăng nhập</button>
        </form>

        <div class="divider">
          <span>hoặc</span>
        </div>

        <div class="switch-auth">
          Chưa có tài khoản? <a onclick="switchToRegister()">Đăng ký ngay</a>
        </div>
      </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('registerModal')">
          ×
        </button>
        <div class="modal-header">
          <div class="modal-icon">🚀</div>
          <h2>Tạo tài khoản mới</h2>
          <p>Đăng ký để bắt đầu đặt vé</p>
        </div>

        <div id="registerAlert" class="alert alert-error">
          <span>⚠️</span>
          <span id="registerAlertMessage"></span>
        </div>

        <form
          class="auth-form"
          id="registerForm"
          onsubmit="handleRegister(event)"
        >
          <div class="form-group">
            <label>Họ và tên <span class="required">*</span></label>
            <input
              type="text"
              id="registerFullName"
              placeholder="VD: Nguyễn Văn A"
              required
            />
            <div class="error-message" id="registerFullNameError"></div>
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input
              type="email"
              id="registerEmail"
              placeholder="VD: user@example.com"
              required
            />
            <div class="error-message" id="registerEmailError"></div>
          </div>

          <div class="form-group">
            <label>Số điện thoại <span class="required">*</span></label>
            <input
              type="tel"
              id="registerPhone"
              placeholder="VD: 0912345678"
              required
            />
            <div class="error-message" id="registerPhoneError"></div>
          </div>

          <div class="form-group">
            <label>Mật khẩu <span class="required">*</span></label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="registerPassword"
                placeholder="Tối thiểu 8 ký tự"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('registerPassword')"
              >
                👁️
              </button>
            </div>
            <div class="password-strength">
              <div class="password-strength-bar" id="passwordStrengthBar"></div>
            </div>
            <div class="password-strength-text" id="passwordStrengthText"></div>
            <div class="error-message" id="registerPasswordError"></div>
          </div>

          <div class="form-group">
            <label>Xác nhận mật khẩu <span class="required">*</span></label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="registerConfirmPassword"
                placeholder="Nhập lại mật khẩu"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('registerConfirmPassword')"
              >
                👁️
              </button>
            </div>
            <div class="error-message" id="registerConfirmPasswordError"></div>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="agreeTerms" required />
            <label for="agreeTerms">
              Tôi đồng ý với
              <a href="#" class="text-link">Điều khoản dịch vụ</a> và
              <a href="#" class="text-link">Chính sách bảo mật</a>
            </label>
          </div>

          <button type="submit" class="submit-btn">Đăng ký</button>
        </form>

        <div class="divider">
          <span>hoặc</span>
        </div>

        <div class="switch-auth">
          Đã có tài khoản? <a onclick="switchToLogin()">Đăng nhập</a>
        </div>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('forgotPasswordModal')">
          ×
        </button>
        <div class="modal-header">
          <div class="modal-icon">🔑</div>
          <h2>Quên mật khẩu?</h2>
          <p>Nhập email để nhận mã xác nhận</p>
        </div>

        <div id="forgotPasswordAlert" class="alert alert-error">
          <span>⚠️</span>
          <span id="forgotPasswordAlertMessage"></span>
        </div>

        <!-- Step 1: Enter Email -->
        <form
          class="auth-form"
          id="forgotPasswordForm"
          onsubmit="handleForgotPassword(event)"
          style="display: block"
        >
          <div class="form-group">
            <label>Email đã đăng ký <span class="required">*</span></label>
            <input
              type="email"
              id="forgotEmail"
              placeholder="VD: user@example.com"
              required
            />
            <div class="error-message" id="forgotEmailError"></div>
          </div>

          <button type="submit" class="submit-btn">Gửi mã xác nhận</button>
        </form>

        <!-- Step 2: Enter OTP -->
        <form
          class="auth-form"
          id="verifyOtpForm"
          onsubmit="handleVerifyOtp(event)"
          style="display: none"
        >
          <div class="form-group">
            <label>Mã xác nhận (OTP) <span class="required">*</span></label>
            <input
              type="text"
              id="otpCode"
              placeholder="Nhập mã 6 số"
              maxlength="6"
              required
            />
            <div class="error-message" id="otpCodeError"></div>
            <p style="font-size: 13px; color: var(--gray-600); margin-top: 8px">
              Mã xác nhận đã được gửi đến email của bạn
            </p>
          </div>

          <button type="submit" class="submit-btn">Xác nhận</button>
          <button
            type="button"
            class="submit-btn"
            onclick="resendOtp()"
            style="background: var(--gray-600); margin-top: 12px"
          >
            Gửi lại mã
          </button>
        </form>

        <!-- Step 3: Reset Password -->
        <form
          class="auth-form"
          id="resetPasswordForm"
          onsubmit="handleResetPassword(event)"
          style="display: none"
        >
          <div class="form-group">
            <label>Mật khẩu mới <span class="required">*</span></label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="newPassword"
                placeholder="Tối thiểu 8 ký tự"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('newPassword')"
              >
                👁️
              </button>
            </div>
            <div class="password-strength">
              <div
                class="password-strength-bar"
                id="newPasswordStrengthBar"
              ></div>
            </div>
            <div
              class="password-strength-text"
              id="newPasswordStrengthText"
            ></div>
            <div class="error-message" id="newPasswordError"></div>
          </div>

          <div class="form-group">
            <label>Xác nhận mật khẩu mới <span class="required">*</span></label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="confirmNewPassword"
                placeholder="Nhập lại mật khẩu mới"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('confirmNewPassword')"
              >
                👁️
              </button>
            </div>
            <div class="error-message" id="confirmNewPasswordError"></div>
          </div>

          <button type="submit" class="submit-btn">Đặt lại mật khẩu</button>
        </form>

        <div class="divider">
          <span>hoặc</span>
        </div>

        <div class="switch-auth">
          Nhớ mật khẩu? <a onclick="switchToLogin()">Đăng nhập</a>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
      <div class="modal-content" style="max-width: 400px; text-align: center">
        <button class="close-modal" onclick="closeModal('successModal')">
          ×
        </button>

        <div
          style="
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 40px;
          "
        >
          ✓
        </div>

        <h2
          style="
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 12px;
          "
        >
          Đăng ký thành công!
        </h2>

        <p style="color: var(--gray-600); font-size: 15px; margin-bottom: 24px">
          Chào mừng bạn đến với Thăng Long Express
        </p>

        <div
          style="
            background: var(--gray-50);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
          "
        >
          <div
            style="
              display: flex;
              align-items: center;
              gap: 12px;
              margin-bottom: 12px;
            "
          >
            <span style="font-size: 24px">👤</span>
            <div style="text-align: left; flex: 1">
              <div style="font-size: 12px; color: var(--gray-600)">
                Họ và tên
              </div>
              <div
                style="
                  font-size: 15px;
                  font-weight: 600;
                  color: var(--gray-900);
                "
                id="successUserName"
              ></div>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px">
            <span style="font-size: 24px">📧</span>
            <div style="text-align: left; flex: 1">
              <div style="font-size: 12px; color: var(--gray-600)">Email</div>
              <div
                style="
                  font-size: 15px;
                  font-weight: 600;
                  color: var(--gray-900);
                "
                id="successUserEmail"
              ></div>
            </div>
          </div>
        </div>

        <button onclick="closeSuccessModal()" class="submit-btn">
          Bắt đầu đặt vé
        </button>
      </div>
    </div>

    <!-- Login Required Modal -->
    <div id="loginRequiredModal" class="login-required-modal">
      <div class="login-required-content">
        <div class="login-required-icon">🔐</div>
        <h2>Vui lòng đăng nhập</h2>
        <p>
          Bạn cần đăng nhập để có thể đặt vé. <br />
          Đăng nhập ngay để tiếp tục đặt vé cho chuyến đi của bạn!
        </p>
        <div class="login-required-actions">
          <button class="btn-login-now" onclick="proceedToLogin()">
            🔑 Đăng nhập ngay
          </button>
          <button class="btn-cancel" onclick="closeLoginRequired()">
            Để sau
          </button>
        </div>
      </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('changePasswordModal')">
          ×
        </button>
        <div class="modal-header">
          <h2>Đổi mật khẩu</h2>
          <p>Cập nhật mật khẩu mới cho tài khoản của bạn</p>
        </div>

        <div id="changePasswordAlert" class="alert alert-error">
          <span>⚠️</span>
          <span id="changePasswordAlertMessage"></span>
        </div>

        <form
          class="auth-form"
          id="changePasswordForm"
          onsubmit="handleChangePassword(event)"
        >
          <div class="form-group">
            <label for="currentPassword">Mật khẩu hiện tại</label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="currentPassword"
                placeholder="Nhập mật khẩu hiện tại"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('currentPassword')"
              >
                👁️
              </button>
            </div>
            <div class="error-message" id="currentPasswordError"></div>
            <div style="text-align: right; margin-top: 8px;">
              <a href="javascript:void(0)" onclick="switchToForgotPassword()" style="color: var(--primary-600); font-size: 14px; text-decoration: none;">
                Quên mật khẩu?
              </a>
            </div>
          </div>

          <div class="form-group">
            <label for="newPassword">Mật khẩu mới</label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="newPasswordChange"
                placeholder="Nhập mật khẩu mới"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('newPasswordChange')"
              >
                👁️
              </button>
            </div>
            <div class="password-strength">
              <div
                class="password-strength-bar"
                id="newPasswordChangeStrengthBar"
              ></div>
            </div>
            <div
              class="password-strength-text"
              id="newPasswordChangeStrengthText"
            ></div>
            <div class="error-message" id="newPasswordChangeError"></div>
          </div>

          <div class="form-group">
            <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
            <div class="password-toggle-group">
              <input
                type="password"
                id="confirmNewPasswordChange"
                placeholder="Nhập lại mật khẩu mới"
                required
              />
              <button
                type="button"
                class="password-toggle-btn"
                onclick="togglePassword('confirmNewPasswordChange')"
              >
                👁️
              </button>
            </div>
            <div class="error-message" id="confirmNewPasswordChangeError"></div>
          </div>

          <button type="submit" class="btn-primary">🔒 Đổi mật khẩu</button>
        </form>
      </div>
    </div>

    <!-- Update Profile Modal -->
    <div id="updateProfileModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('updateProfileModal')">
          ×
        </button>
        <div class="modal-header">
          <h2>👤 Cập nhật thông tin</h2>
          <p>Chỉnh sửa thông tin cá nhân của bạn</p>
        </div>

        <div id="updateProfileAlert" class="alert alert-error">
          <span>⚠️</span>
          <span id="updateProfileAlertMessage"></span>
        </div>

        <form
          class="auth-form"
          id="updateProfileForm"
          onsubmit="handleUpdateProfile(event)"
        >
          <div class="form-group">
            <label for="updateFullName">Họ và tên <span class="required">*</span></label>
            <input
              type="text"
              id="updateFullName"
              placeholder="Nhập họ và tên"
              required
            />
            <div class="error-message" id="updateFullNameError"></div>
          </div>

          <div class="form-group">
            <label for="updateEmail">Email <span class="required">*</span></label>
            <input
              type="email"
              id="updateEmail"
              placeholder="VD: user@example.com"
              required
            />
            <div class="error-message" id="updateEmailError"></div>
          </div>

          <div class="form-group">
            <label for="updatePhone">Số điện thoại <span class="required">*</span></label>
            <input
              type="tel"
              id="updatePhone"
              placeholder="VD: 0912345678"
              required
            />
            <div class="error-message" id="updatePhoneError"></div>
          </div>

          <button type="submit" class="btn-primary">💾 Lưu thay đổi</button>
        </form>
      </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="modal">
      <div class="modal-content" style="max-width: 450px;">
        <div class="logout-modal-content">
          <div class="logout-icon">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
              <circle cx="40" cy="40" r="38" fill="#FEF3C7" stroke="#F59E0B" stroke-width="3"/>
              <path d="M40 25V42" stroke="#F59E0B" stroke-width="4" stroke-linecap="round"/>
              <path d="M40 50V52" stroke="#F59E0B" stroke-width="4" stroke-linecap="round"/>
            </svg>
          </div>
          <h2 class="logout-title">Xác nhận đăng xuất</h2>
          <p class="logout-message">
            Bạn có chắc chắn muốn đăng xuất khỏi tài khoản?
          </p>
          <div class="logout-actions">
            <button class="btn-logout-cancel" onclick="closeModal('logoutModal')">
              Hủy
            </button>
            <button class="btn-logout-confirm" onclick="confirmLogout()">
              Đăng xuất
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="booking-modal">
      <div class="booking-modal-content">
        <div class="booking-modal-header">
          <button class="close-booking-modal" onclick="closeBookingModal()">
            ×
          </button>
          <h2 id="bookingModalTitle">Đặt vé xe khách</h2>
          <p id="bookingModalSubtitle">Chọn ghế và điền thông tin hành khách</p>
        </div>

        <div class="booking-modal-body">
          <!-- Trip Summary -->
          <div class="trip-summary">
            <div class="trip-summary-row">
              <span class="trip-summary-label">Tuyến đường:</span>
              <span class="trip-summary-value" id="summaryRoute"
                >Hà Nội → Hải Phòng</span
              >
            </div>
            <div class="trip-summary-row">
              <span class="trip-summary-label">Ngày khởi hành:</span>
              <span class="trip-summary-value" id="summaryDate"
                >13/12/2024</span
              >
            </div>
            <div class="trip-summary-row">
              <span class="trip-summary-label">Giờ khởi hành:</span>
              <span class="trip-summary-value" id="summaryTime">08:00</span>
            </div>
            <div class="trip-summary-row">
              <span class="trip-summary-label">Loại xe:</span>
              <span class="trip-summary-value" id="summaryType">Xe khách</span>
            </div>
            <div class="trip-summary-row">
              <span class="trip-summary-label">Giá vé (1 người):</span>
              <span class="trip-summary-value" id="summaryPrice"
                >130,000 VNĐ</span
              >
            </div>
            <div class="trip-summary-row">
              <span class="trip-summary-label">Tổng tiền:</span>
              <span class="trip-summary-total" id="summaryTotal"
                >130,000 VNĐ</span
              >
            </div>
          </div>

          <!-- Seat Selection (for Bus only) -->
          <div
            class="seat-selection-container"
            id="seatSelectionContainer"
            style="display: none"
          >
            <div class="seat-selection-header">
              <h3>Chọn ghế ngồi</h3>
              <div class="seats-selected">
                Đã chọn: <strong id="selectedSeatsCount">0</strong> ghế
              </div>
            </div>

            <div class="seat-legend">
              <div class="legend-item">
                <div class="legend-box available">A1</div>
                <span>Còn trống</span>
              </div>
              <div class="legend-item">
                <div class="legend-box selected">A1</div>
                <span>Đã chọn</span>
              </div>
              <div class="legend-item">
                <div class="legend-box occupied">A1</div>
                <span>Đã có người</span>
              </div>
            </div>

            <div class="bus-layout">
              <div class="driver-section">
                <div class="driver-icon">🚗 Tài xế</div>
              </div>
              <div class="seats-grid" id="seatsGrid">
                <!-- Seats will be generated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Passenger Info -->
          <div class="passenger-info-container">
            <h3>Thông tin hành khách</h3>
            <form class="passenger-form" id="passengerForm">
              <!-- Pickup Location (Limousine only) -->
              <div
                class="form-group full-width"
                id="pickupLocationGroup"
                style="display: none"
              >
                <label>Điểm đón <span class="required">*</span></label>
                <input
                  type="text"
                  id="pickupLocation"
                  placeholder="VD: 123 Đường ABC, Quận X, Hà Nội"
                />
                <p
                  style="
                    font-size: 12px;
                    color: var(--gray-600);
                    margin-top: 4px;
                  "
                >
                  📍 Nhập địa chỉ cụ thể để tài xế đến đón bạn
                </p>
              </div>

              <div class="form-group">
                <label>Họ và tên <span class="required">*</span></label>
                <input
                  type="text"
                  id="passengerName"
                  placeholder="VD: Nguyễn Văn A"
                  required
                />
              </div>
              <div class="form-group">
                <label>Số điện thoại <span class="required">*</span></label>
                <input
                  type="tel"
                  id="passengerPhone"
                  placeholder="VD: 0912345678"
                  required
                />
              </div>
              <div class="form-group full-width">
                <label>Email</label>
                <input
                  type="email"
                  id="passengerEmail"
                  placeholder="VD: user@example.com"
                />
              </div>
              <div class="form-group full-width">
                <label>Ghi chú</label>
                <input
                  type="text"
                  id="passengerNote"
                  placeholder="Thông tin thêm (nếu có)"
                />
              </div>
            </form>
          </div>

          <!-- Payment Method -->
          <!-- Payment Method -->
          <div class="payment-method-container">
            <h3>Phương thức thanh toán</h3>
            <div class="payment-methods">
              <!-- Bank Transfer -->
              <div
                class="payment-method selected"
                onclick="selectPaymentMethod('bank')"
                id="payment-bank"
              >
                <div class="payment-radio"></div>
                <div class="payment-icon">🏦</div>
                <div class="payment-info">
                  <div class="payment-name">Chuyển khoản ngân hàng</div>
                  <div class="payment-desc">Chuyển khoản trước chuyến đi</div>
                </div>
              </div>

              <!-- E-Wallet -->
              <div
                class="payment-method"
                onclick="selectPaymentMethod('ewallet')"
                id="payment-ewallet"
              >
                <div class="payment-radio"></div>
                <div class="payment-icon">📱</div>
                <div class="payment-info">
                  <div class="payment-name">Ví điện tử</div>
                  <div class="payment-desc">MoMo, ZaloPay, VNPay</div>
                </div>
              </div>

              <!-- Credit Card -->
              <div
                class="payment-method"
                onclick="selectPaymentMethod('card')"
                id="payment-card"
              >
                <div class="payment-radio"></div>
                <div class="payment-icon">💳</div>
                <div class="payment-info">
                  <div class="payment-name">Thẻ tín dụng/ghi nợ</div>
                  <div class="payment-desc">Visa, Mastercard, JCB</div>
                </div>
              </div>
            </div>

            <!-- Payment Notes (Hidden - Demo Mode) -->
            <div
              class="payment-note"
              id="payment-bank-note"
              style="display: none"
            ></div>
            <div
              class="payment-note"
              id="payment-ewallet-note"
              style="display: none"
            ></div>
            <div
              class="payment-note"
              id="payment-card-note"
              style="display: none"
            ></div>
          </div>

          <!-- Confirm Button -->
          <button
            class="confirm-booking-btn"
            onclick="confirmBooking()"
            id="confirmBookingBtn"
          >
            💳 Xác nhận đặt vé
          </button>
        </div>
      </div>
    </div>
    <!-- Booking Review Modal -->
    <div id="bookingReviewModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <button class="close-modal" onclick="closeModal('bookingReviewModal')">
          ×
        </button>
        <div class="modal-header">
          <h2>Xem lại thông tin đặt vé</h2>
          <p>Vui lòng kiểm tra kỹ thông tin trước khi xác nhận</p>
        </div>

        <div class="booking-review-content" id="bookingReviewContent">
          <!-- Review content will be inserted here -->
        </div>

        <div class="booking-review-actions">
          <button class="btn-secondary" onclick="closeModal('bookingReviewModal')">
            ← Quay lại chỉnh sửa
          </button>
          <button class="btn-primary" onclick="finalConfirmBooking()">
            ✓ Xác nhận đặt vé
          </button>
        </div>
      </div>
    </div>

    <!-- Booking Success Modal -->
    <div id="bookingSuccessModal" class="booking-success-modal">
      <div class="booking-success-content">
        <div class="success-icon-wrapper">
          <svg
            class="checkmark"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 52 52"
          >
            <circle
              class="checkmark-circle"
              cx="26"
              cy="26"
              r="25"
              fill="none"
              stroke-dasharray="166"
              stroke-dashoffset="166"
            />
            <path
              class="checkmark-check"
              fill="none"
              d="M14.1 27.2l7.1 7.2 16.7-16.8"
              stroke-dasharray="48"
              stroke-dashoffset="48"
            />
          </svg>
        </div>

        <h2>Đặt vé thành công!</h2>
        <p class="subtitle">
          Cảm ơn bạn đã sử dụng dịch vụ của Thăng Long Express
        </p>

        <div class="booking-details" id="bookingDetailsContent">
          <!-- Booking details will be inserted here -->
        </div>

        <div class="booking-notice" id="bookingNotice">
          <!-- Notice will be inserted here -->
        </div>

        <div class="booking-success-actions">
          <button class="btn-view-booking" onclick="viewMyBookings()">
            📋 Xem vé của tôi
          </button>
          <button class="btn-close-success" onclick="closeBookingSuccess()">
            Đóng
          </button>
        </div>
      </div>
    </div>

    <!-- My Bookings Modal -->
    <div id="myBookingsModal" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <button class="close-modal" onclick="closeModal('myBookingsModal')">
          ×
        </button>
        <div class="modal-header">
          <h2>🎟️ Vé của tôi</h2>
          <p>Quản lý tất cả các vé xe đã đặt</p>
        </div>

        <div class="my-bookings-container" id="myBookingsContainer">
          <!-- Bookings will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Booking Detail Modal -->
    <div id="bookingDetailModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <button class="close-modal" onclick="closeModal('bookingDetailModal')">
          ×
        </button>
        <div class="modal-header">
          <h2>Chi tiết vé</h2>
          <p>Thông tin chi tiết đặt vé của bạn</p>
        </div>

        <div id="bookingDetailContent">
          <!-- Detail content will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Cannot Cancel Warning Modal -->
    <div id="cannotCancelModal" class="modal">
      <div class="modal-content" style="max-width: 500px;">
        <div class="cannot-cancel-content">
          <div class="warning-icon-large">
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
              <circle cx="50" cy="50" r="48" stroke="#F59E0B" stroke-width="4" fill="#FFFBEB"/>
              <path d="M50 30V55" stroke="#F59E0B" stroke-width="5" stroke-linecap="round"/>
              <circle cx="50" cy="70" r="4" fill="#F59E0B"/>
            </svg>
          </div>

          <h2 class="warning-title">⚠️ Không thể hủy vé</h2>
          <p class="warning-message" id="cannotCancelMessage">
            Chỉ có thể hủy vé trước 24 giờ so với giờ khởi hành.
          </p>

          <div class="cannot-cancel-info" id="cannotCancelTicketInfo">
            <!-- Ticket info will be inserted here -->
          </div>

          <div class="info-box">
            <div class="info-box-icon">📞</div>
            <div class="info-box-content">
              <strong>Cần hỗ trợ?</strong>
              <p>Vui lòng liên hệ hotline: <strong>1900 1234</strong> để được tư vấn</p>
            </div>
          </div>

          <div class="warning-actions">
            <button class="btn-warning-ok" onclick="closeModal('cannotCancelModal')">
              Đã hiểu
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div id="cancelConfirmModal" class="modal">
      <div class="modal-content" style="max-width: 480px;">
        <div class="cancel-confirm-content">
          <div class="cancel-icon">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
              <circle cx="40" cy="40" r="38" stroke="#EF4444" stroke-width="4" fill="#FEF2F2"/>
              <path d="M40 25V45" stroke="#EF4444" stroke-width="4" stroke-linecap="round"/>
              <circle cx="40" cy="55" r="3" fill="#EF4444"/>
            </svg>
          </div>

          <h2 class="cancel-title">Xác nhận hủy vé?</h2>
          <p class="cancel-message" id="cancelMessage">
            Bạn có chắc chắn muốn hủy vé này không?
          </p>

          <div class="cancel-info" id="cancelTicketInfo">
            <!-- Ticket info will be inserted here -->
          </div>

          <div class="cancel-warning">
            <span class="warning-icon">⚠️</span>
            <span>Hành động này không thể hoàn tác</span>
          </div>

          <div class="cancel-actions">
            <button class="btn-cancel-no" onclick="closeModal('cancelConfirmModal')">
              ← Không, giữ vé
            </button>
            <button class="btn-cancel-yes" id="confirmCancelBtn" onclick="confirmCancelTicket()">
              Có, hủy vé
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Cancel Success Modal -->
    <div id="cancelSuccessModal" class="modal">
      <div class="modal-content" style="max-width: 480px;">
        <div class="cancel-success-content">
          <div class="success-icon">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
              <circle cx="40" cy="40" r="38" stroke="#10B981" stroke-width="4" fill="#F0FDF4"/>
              <path d="M25 40L35 50L55 30" stroke="#10B981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>

          <h2 class="success-title">✓ Hủy vé thành công!</h2>
          <p class="success-message">
            Vé của bạn đã được hủy thành công. Số tiền sẽ được hoàn lại trong vòng 3-5 ngày làm việc.
          </p>

          <div class="success-actions">
            <button class="btn-success-ok" onclick="closeCancelSuccess()">
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Same Location Warning Modal -->
    <div id="sameLocationModal" class="modal">
      <div class="modal-content" style="max-width: 450px;">
        <div class="cannot-cancel-content">
          <div class="warning-icon-large">
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
              <circle cx="50" cy="50" r="48" stroke="#F59E0B" stroke-width="4" fill="#FFFBEB"/>
              <path d="M50 30V55" stroke="#F59E0B" stroke-width="5" stroke-linecap="round"/>
              <circle cx="50" cy="70" r="4" fill="#F59E0B"/>
            </svg>
          </div>

          <h2 class="warning-title">⚠️ Thông tin không hợp lệ</h2>
          <p class="warning-message">
            Điểm đi và điểm đến không thể giống nhau. Vui lòng chọn điểm đến khác.
          </p>

          <div class="warning-actions">
            <button class="btn-warning-ok" onclick="closeModal('sameLocationModal')">
              Đã hiểu
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript -->

    <!-- JavaScript -->
    <script>
      // ============================================
      // DATA STRUCTURE
      // ============================================

      // Location mapping
      const locations = {
        hanoi: "Hà Nội",
        haiphong: "Hải Phòng",
        thaibinh: "Thái Bình",
        thanhhoa: "Thanh Hóa",
        nghean: "Nghệ An",
        hatinh: "Hà Tĩnh",
      };

      // Routes and prices
      const routesData = {
        "hanoi-haiphong": {
          bus: { price: 130000, duration: "2h30m", distance: "120km" },
          limousine: { price: 250000, duration: "2h15m", distance: "120km" },
        },
        "hanoi-thaibinh": {
          bus: { price: 130000, duration: "2h45m", distance: "115km" },
          limousine: { price: 250000, duration: "2h30m", distance: "115km" },
        },
        "hanoi-thanhhoa": {
          bus: { price: 200000, duration: "4h00m", distance: "160km" },
          limousine: { price: 280000, duration: "3h45m", distance: "160km" },
        },
        "hanoi-nghean": {
          bus: { price: 260000, duration: "5h30m", distance: "290km" },
          limousine: { price: 320000, duration: "5h00m", distance: "290km" },
        },
        "hanoi-hatinh": {
          bus: { price: 300000, duration: "6h30m", distance: "340km" },
          limousine: { price: 380000, duration: "6h00m", distance: "340km" },
        },
      };

      // Generate departure times
      const departureTimes = [
        "06:00",
        "08:00",
        "10:00",
        "12:00",
        "14:00",
        "16:00",
        "18:00",
        "20:00",
        "22:00",
      ];

      // Global variables
      let allTrips = [];
      let filteredTrips = [];
      let currentFilter = "all";
      let searchParams = {};

      // ============================================
      // INITIALIZATION
      // ============================================

      document.addEventListener("DOMContentLoaded", function () {
        // Set min date for date picker
        const dateInput = document.getElementById("date");
        const today = new Date().toISOString().split("T")[0];
        dateInput.setAttribute("min", today);
        dateInput.value = today;

        // Check if user is logged in
        const savedUser = localStorage.getItem("currentUser");
        if (savedUser) {
          currentUser = JSON.parse(savedUser);
          updateUIForLoggedInUser();
        }

        // Add password strength checker
        const registerPassword = document.getElementById("registerPassword");
        if (registerPassword) {
          registerPassword.addEventListener("input", checkPasswordStrength);
        }
      });

      // ============================================
      // AUTHENTICATION FUNCTIONS
      // ============================================

      let currentUser = null;

      /**
       * Handle user login
       */
      function handleLogin(event) {
        event.preventDefault();

        // Clear previous alerts
        hideAlert("loginAlert");
        clearErrors(["loginIdentifier", "loginPassword"]);

        const identifier = document
          .getElementById("loginIdentifier")
          .value.trim();
        const password = document.getElementById("loginPassword").value;

        // Validation
        if (!identifier) {
          showFieldError(
            "loginIdentifier",
            "Vui lòng nhập email hoặc số điện thoại"
          );
          return;
        }

        if (!password) {
          showFieldError("loginPassword", "Vui lòng nhập mật khẩu");
          return;
        }

        // Get stored users
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        // Find user by email or phone
        const user = users.find(
          (u) => u.email === identifier || u.phone === identifier
        );

        if (!user) {
          showAlert("loginAlert", "Tài khoản không tồn tại!", "error");
          return;
        }

        if (user.password !== password) {
          showAlert("loginAlert", "Mật khẩu không chính xác!", "error");
          return;
        }

        // Login successful
        currentUser = {
          fullName: user.fullName,
          email: user.email,
          phone: user.phone,
          loginTime: new Date().toISOString(),
        };

        localStorage.setItem("currentUser", JSON.stringify(currentUser));

        // Close login modal and show success modal
        closeModal("loginModal");
        showSuccessModal();
      }

      /**
       * Handle user registration
       */
      function handleRegister(event) {
        event.preventDefault();

        // Clear previous alerts
        hideAlert("registerAlert");
        clearErrors([
          "registerFullName",
          "registerEmail",
          "registerPhone",
          "registerPassword",
          "registerConfirmPassword",
        ]);

        const fullName = document
          .getElementById("registerFullName")
          .value.trim();
        const email = document.getElementById("registerEmail").value.trim();
        const phone = document.getElementById("registerPhone").value.trim();
        const password = document.getElementById("registerPassword").value;
        const confirmPassword = document.getElementById(
          "registerConfirmPassword"
        ).value;
        const agreeTerms = document.getElementById("agreeTerms").checked;

        // Validation
        let hasError = false;

        // Full name validation
        if (!fullName || fullName.length < 2) {
          showFieldError("registerFullName", "Họ tên phải có ít nhất 2 ký tự");
          hasError = true;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
          showFieldError("registerEmail", "Email không hợp lệ");
          hasError = true;
        }

        // Phone validation
        const phoneRegex = /^(0|\+84)[0-9]{9}$/;
        if (!phone || !phoneRegex.test(phone)) {
          showFieldError(
            "registerPhone",
            "Số điện thoại không hợp lệ (VD: 0912345678)"
          );
          hasError = true;
        }

        // Password validation
        // Password validation - check all requirements
        const passwordErrors = [];
        if (!password || password.length < 8) {
          passwordErrors.push("Tối thiểu 8 ký tự");
        }
        if (!/[a-z]/.test(password)) {
          passwordErrors.push("Ít nhất 1 chữ thường (a-z)");
        }
        if (!/[A-Z]/.test(password)) {
          passwordErrors.push("Ít nhất 1 chữ hoa (A-Z)");
        }
        if (!/[0-9]/.test(password)) {
          passwordErrors.push("Ít nhất 1 chữ số (0-9)");
        }
        if (!/[^a-zA-Z0-9]/.test(password)) {
          passwordErrors.push("Ít nhất 1 ký tự đặc biệt (!@#$%^&*...)");
        }

        if (passwordErrors.length > 0) {
          showFieldError(
            "registerPassword",
            "Mật khẩu thiếu: " + passwordErrors.join(", ")
          );
          hasError = true;
        }
        // Check if confirmed password matches (Đã cập nhật)
        if (password !== confirmPassword) {
          showFieldError(
            "registerConfirmPassword",
            "Mật khẩu xác nhận không khớp"
          );
          hasError = true;
        }
        // Terms agreement validation
        if (!agreeTerms) {
          showAlert(
            "registerAlert",
            "Vui lòng đồng ý với điều khoản dịch vụ",
            "error"
          );
          hasError = true;
        }

        if (hasError) return;

        // Check if user already exists
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        const emailExists = users.some((u) => u.email === email);
        if (emailExists) {
          showAlert("registerAlert", "Email đã được đăng ký!", "error");
          return;
        }

        const phoneExists = users.some((u) => u.phone === phone);
        if (phoneExists) {
          showAlert("registerAlert", "Số điện thoại đã được đăng ký!", "error");
          return;
        }

        // Register new user
        const newUser = {
          id: Date.now().toString(),
          fullName,
          email,
          phone,
          password,
          createdAt: new Date().toISOString(),
        };

        users.push(newUser);
        localStorage.setItem("users", JSON.stringify(users));

        // Auto login after registration
        currentUser = {
          fullName: newUser.fullName,
          email: newUser.email,
          phone: newUser.phone,
          loginTime: new Date().toISOString(),
        };
        localStorage.setItem("currentUser", JSON.stringify(currentUser));

        // Close register modal and show success modal
        closeModal("registerModal");
        showSuccessModal();
      }

      /**
       * Handle user logout
       */
      function handleLogout() {
        // Show logout confirmation modal
        document.getElementById("logoutModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Confirm and execute logout
       */
      function confirmLogout() {
        currentUser = null;
        localStorage.removeItem("currentUser");
        closeModal("logoutModal");
        updateUIForLoggedOutUser();

        // Show success message
        showSuccessPopup("✓ Đã đăng xuất thành công!");
      }

      /**
       * Show change password modal
       */
      function showChangePasswordModal() {
        document.getElementById("changePasswordModal").classList.add("show");
        document.body.style.overflow = "hidden";
        hideAlert("changePasswordAlert");
        clearErrors([
          "currentPassword",
          "newPasswordChange",
          "confirmNewPasswordChange",
        ]);

        // Add password strength checker for new password
        const newPasswordInput = document.getElementById("newPasswordChange");
        if (newPasswordInput && !newPasswordInput.dataset.listenerAdded) {
          newPasswordInput.addEventListener("input", function() {
            checkPasswordStrengthForField("newPasswordChange", "newPasswordChangeStrengthBar", "newPasswordChangeStrengthText");
          });
          newPasswordInput.dataset.listenerAdded = "true";
        }
      }

      /**
       * Switch from change password to forgot password flow
       */
      function switchToForgotPassword() {
        // Close change password modal
        closeModal("changePasswordModal");

        // Open forgot password modal after a short delay for smooth transition
        setTimeout(() => {
          showForgotPasswordModal();
        }, 300);
      }

      /**
       * Handle change password
       */
      function handleChangePassword(event) {
        event.preventDefault();

        hideAlert("changePasswordAlert");
        clearErrors([
          "currentPassword",
          "newPasswordChange",
          "confirmNewPasswordChange",
        ]);

        const currentPassword = document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("newPasswordChange").value;
        const confirmNewPassword = document.getElementById("confirmNewPasswordChange").value;

        // Validation
        if (!currentPassword) {
          showFieldError("currentPassword", "Vui lòng nhập mật khẩu hiện tại");
          return;
        }

        // Validate new password requirements
        const passwordErrors = [];
        if (!newPassword || newPassword.length < 8) {
          passwordErrors.push("Tối thiểu 8 ký tự");
        }
        if (!/[a-z]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ thường (a-z)");
        }
        if (!/[A-Z]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ hoa (A-Z)");
        }
        if (!/[0-9]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ số (0-9)");
        }
        if (!/[^a-zA-Z0-9]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 ký tự đặc biệt (!@#$%^&*)");
        }

        if (passwordErrors.length > 0) {
          showFieldError(
            "newPasswordChange",
            "Mật khẩu cần có: " + passwordErrors.join(", ")
          );
          return;
        }

        if (newPassword !== confirmNewPassword) {
          showFieldError("confirmNewPasswordChange", "Mật khẩu xác nhận không khớp");
          return;
        }

        // Get stored users
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        // Find current user
        const userIndex = users.findIndex(
          (u) => u.email === currentUser.email
        );

        if (userIndex === -1) {
          showAlert("changePasswordAlert", "Không tìm thấy tài khoản!", "error");
          return;
        }

        // Verify current password
        if (users[userIndex].password !== currentPassword) {
          showFieldError("currentPassword", "Mật khẩu hiện tại không chính xác");
          return;
        }

        // Check if new password is same as old password
        if (currentPassword === newPassword) {
          showFieldError("newPasswordChange", "Mật khẩu mới phải khác mật khẩu hiện tại");
          return;
        }

        // Update password
        users[userIndex].password = newPassword;
        localStorage.setItem("users", JSON.stringify(users));

        // Reset form
        document.getElementById("changePasswordForm").reset();
        document.getElementById("newPasswordChangeStrengthBar").className = "password-strength-bar";
        document.getElementById("newPasswordChangeStrengthText").textContent = "";

        // Close modal
        closeModal("changePasswordModal");

        // Show success popup
        showSuccessPopup("✓ Đổi mật khẩu thành công! Vui lòng đăng nhập lại.");

        // Logout after 2.5 seconds (to allow popup to be seen)
        setTimeout(() => {
          handleLogout();
        }, 2500);
      }

      /**
       * Check password strength for a specific field
       */
      function checkPasswordStrengthForField(inputId, barId, textId) {
        const password = document.getElementById(inputId).value;
        const strengthBar = document.getElementById(barId);
        const strengthText = document.getElementById(textId);

        if (!password) {
          strengthBar.className = "password-strength-bar";
          strengthText.textContent = "";
          return;
        }

        let strength = 0;

        // Check length
        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;

        // Check character types
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        // Set strength level
        if (strength <= 2) {
          strengthBar.className = "password-strength-bar weak";
          strengthText.textContent = "Mật khẩu yếu";
          strengthText.style.color = "var(--danger-color)";
        } else if (strength <= 4) {
          strengthBar.className = "password-strength-bar medium";
          strengthText.textContent = "Mật khẩu trung bình";
          strengthText.style.color = "var(--warning-color)";
        } else {
          strengthBar.className = "password-strength-bar strong";
          strengthText.textContent = "Mật khẩu mạnh";
          strengthText.style.color = "var(--success-color)";
        }
      }

      /**
       * Update UI when user is logged in
       */
      function updateUIForLoggedInUser() {
        const userActions = document.getElementById("userActions");
        const initials = currentUser.fullName
          .split(" ")
          .map((n) => n[0])
          .join("")
          .toUpperCase()
          .substring(0, 2);

        userActions.innerHTML = `
          <div class="user-info">
            <div class="user-avatar">${initials}</div>
            <span class="user-name">${currentUser.fullName}</span>
            <span class="account-settings-btn" onclick="toggleSettingsDropdown()">
              ⚙️ Cài đặt tài khoản
              <div class="settings-dropdown" id="settingsDropdown">
                <div class="settings-dropdown-item" onclick="event.stopPropagation(); showUpdateProfileModal()">
                  <span class="icon">👤</span>
                  <span class="text">Cập nhật thông tin</span>
                </div>
                <div class="settings-dropdown-item" onclick="event.stopPropagation(); showChangePasswordModal()">
                  <span class="icon">🔒</span>
                  <span class="text">Đổi mật khẩu</span>
                </div>
              </div>
            </span>
            <span class="logout-btn" onclick="handleLogout()">Đăng xuất</span>
          </div>
        `;
      }

      /**
       * Update UI when user is logged out
       */
      function updateUIForLoggedOutUser() {
        const userActions = document.getElementById("userActions");
        userActions.innerHTML = `
          <a onclick="showLoginModal()">Đăng nhập</a>
          <a onclick="showRegisterModal()">Đăng ký</a>
        `;
      }

      /**
       * Show login modal
       */
      function showLoginModal() {
        document.getElementById("loginModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Show register modal
       */
      function showRegisterModal() {
        document.getElementById("registerModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Show forgot password modal
       */
      function showForgotPasswordModal() {
        closeModal("loginModal");
        setTimeout(() => {
          document.getElementById("forgotPasswordModal").classList.add("show");
          document.body.style.overflow = "hidden";
          // Reset to step 1
          resetForgotPasswordSteps();
        }, 300);
      }

      /**
       * Show success modal after login/register
       */
      function showSuccessModal() {
        document.getElementById("successUserName").textContent =
          currentUser.fullName;
        document.getElementById("successUserEmail").textContent =
          currentUser.email;
        document.getElementById("successModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Close success modal and update UI
       */
      function closeSuccessModal() {
        closeModal("successModal");
        updateUIForLoggedInUser();

        // Reset forms
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        if (loginForm) loginForm.reset();
        if (registerForm) {
          registerForm.reset();
          document.getElementById("passwordStrengthBar").className =
            "password-strength-bar";
          document.getElementById("passwordStrengthText").textContent = "";
        }

        // If there was a pending booking, continue with it
        if (pendingBookingTripId) {
          const trip = allTrips.find((t) => t.id === pendingBookingTripId);
          if (trip) {
            setTimeout(() => {
              openBookingModal(trip);
              pendingBookingTripId = null;
            }, 300);
          }
        }
      }

      // ============================================
      // FORGOT PASSWORD FUNCTIONS
      // ============================================

      let forgotPasswordEmail = "";
      let generatedOtp = "";
      let otpExpiry = null;

      /**
       * Reset forgot password modal to step 1
       */
      function resetForgotPasswordSteps() {
        document.getElementById("forgotPasswordForm").style.display = "block";
        document.getElementById("verifyOtpForm").style.display = "none";
        document.getElementById("resetPasswordForm").style.display = "none";

        // Reset modal header
        document.querySelector("#forgotPasswordModal .modal-icon").textContent =
          "🔑";
        document.querySelector("#forgotPasswordModal h2").textContent =
          "Quên mật khẩu?";
        document.querySelector(
          "#forgotPasswordModal .modal-header p"
        ).textContent = "Nhập email để nhận mã xác nhận";

        hideAlert("forgotPasswordAlert");

        // Clear forms
        document.getElementById("forgotEmail").value = "";
        document.getElementById("otpCode").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("confirmNewPassword").value = "";

        forgotPasswordEmail = "";
        generatedOtp = "";
        otpExpiry = null;
      }

      /**
       * Handle forgot password - Step 1: Send OTP
       */
      function handleForgotPassword(event) {
        event.preventDefault();

        hideAlert("forgotPasswordAlert");
        clearErrors(["forgotEmail"]);

        const email = document.getElementById("forgotEmail").value.trim();

        // Validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
          showFieldError("forgotEmail", "Email không hợp lệ");
          return;
        }

        // Check if email exists
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const user = users.find((u) => u.email === email);

        if (!user) {
          showAlert("forgotPasswordAlert", "Email chưa được đăng ký!", "error");
          return;
        }

        // Generate OTP (6 digits)
        generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
        otpExpiry = Date.now() + 5 * 60 * 1000; // 5 minutes
        forgotPasswordEmail = email;

        // In real app, send OTP via email
        console.log("🔐 Generated OTP:", generatedOtp);

        // Show success and move to step 2
        showAlert(
          "forgotPasswordAlert",
          `Mã xác nhận đã được gửi đến ${email}. Mã OTP: ${generatedOtp}`,
          "success"
        );

        setTimeout(() => {
          document.getElementById("forgotPasswordForm").style.display = "none";
          document.getElementById("verifyOtpForm").style.display = "block";

          // Update modal header
          document.querySelector(
            "#forgotPasswordModal .modal-icon"
          ).textContent = "📧";
          document.querySelector("#forgotPasswordModal h2").textContent =
            "Xác nhận mã OTP";
          document.querySelector(
            "#forgotPasswordModal .modal-header p"
          ).textContent = "Nhập mã xác nhận đã gửi đến email";

          hideAlert("forgotPasswordAlert");
        }, 2000);
      }

      /**
       * Resend OTP
       */
      function resendOtp() {
        if (!forgotPasswordEmail) return;

        // Generate new OTP
        generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
        otpExpiry = Date.now() + 5 * 60 * 1000;

        console.log("🔐 Resent OTP:", generatedOtp);
        showAlert(
          "forgotPasswordAlert",
          `Mã xác nhận mới: ${generatedOtp}`,
          "success"
        );

        setTimeout(() => {
          hideAlert("forgotPasswordAlert");
        }, 3000);
      }

      /**
       * Handle verify OTP - Step 2
       */
      function handleVerifyOtp(event) {
        event.preventDefault();

        hideAlert("forgotPasswordAlert");
        clearErrors(["otpCode"]);

        const otp = document.getElementById("otpCode").value.trim();

        // Validation
        if (!otp || otp.length !== 6) {
          showFieldError("otpCode", "Vui lòng nhập mã OTP 6 số");
          return;
        }

        // Check OTP expiry
        if (Date.now() > otpExpiry) {
          showAlert(
            "forgotPasswordAlert",
            "Mã OTP đã hết hạn. Vui lòng gửi lại mã mới.",
            "error"
          );
          return;
        }

        // Verify OTP
        if (otp !== generatedOtp) {
          showAlert("forgotPasswordAlert", "Mã OTP không chính xác!", "error");
          return;
        }

        // OTP correct, move to step 3
        showAlert("forgotPasswordAlert", "Xác nhận thành công!", "success");

        setTimeout(() => {
          document.getElementById("verifyOtpForm").style.display = "none";
          document.getElementById("resetPasswordForm").style.display = "block";

          // Update modal header
          document.querySelector(
            "#forgotPasswordModal .modal-icon"
          ).textContent = "🔒";
          document.querySelector("#forgotPasswordModal h2").textContent =
            "Đặt lại mật khẩu";
          document.querySelector(
            "#forgotPasswordModal .modal-header p"
          ).textContent = "Nhập mật khẩu mới cho tài khoản";

          hideAlert("forgotPasswordAlert");

          // Add password strength checker for new password
          const newPasswordInput = document.getElementById("newPassword");
          newPasswordInput.removeEventListener(
            "input",
            checkNewPasswordStrength
          );
          newPasswordInput.addEventListener("input", checkNewPasswordStrength);
        }, 1500);
      }

      /**
       * Handle reset password - Step 3
       */
      function handleResetPassword(event) {
        event.preventDefault();

        hideAlert("forgotPasswordAlert");
        clearErrors(["newPassword", "confirmNewPassword"]);

        const newPassword = document.getElementById("newPassword").value;
        const confirmNewPassword =
          document.getElementById("confirmNewPassword").value;

        // Validation
        // Validation - Strong password requirements
        let hasError = false;

        const passwordErrors = [];
        if (!newPassword || newPassword.length < 8) {
          passwordErrors.push("Tối thiểu 8 ký tự");
        }
        if (!/[a-z]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ thường (a-z)");
        }
        if (!/[A-Z]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ hoa (A-Z)");
        }
        if (!/[0-9]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 chữ số (0-9)");
        }
        if (!/[^a-zA-Z0-9]/.test(newPassword)) {
          passwordErrors.push("Ít nhất 1 ký tự đặc biệt (!@#$%^&*...)");
        }

        if (passwordErrors.length > 0) {
          showFieldError(
            "newPassword",
            "Mật khẩu thiếu: " + passwordErrors.join(", ")
          );
          hasError = true;
        }

        if (newPassword !== confirmNewPassword) {
          showFieldError("confirmNewPassword", "Mật khẩu xác nhận không khớp");
          hasError = true;
        }

        if (hasError) return;

        // Update password in storage
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const userIndex = users.findIndex(
          (u) => u.email === forgotPasswordEmail
        );

        if (userIndex !== -1) {
          users[userIndex].password = newPassword;
          localStorage.setItem("users", JSON.stringify(users));

          showAlert(
            "forgotPasswordAlert",
            "Đặt lại mật khẩu thành công!",
            "success"
          );

          setTimeout(() => {
            closeModal("forgotPasswordModal");
            showLoginModal();
            showAlert(
              "loginAlert",
              "Vui lòng đăng nhập với mật khẩu mới",
              "success"
            );

            setTimeout(() => {
              hideAlert("loginAlert");
            }, 3000);
          }, 1500);
        } else {
          showAlert(
            "forgotPasswordAlert",
            "Có lỗi xảy ra. Vui lòng thử lại!",
            "error"
          );
        }
      }

      /**
       * Check new password strength for forgot password flow
       */
      function checkNewPasswordStrength() {
        const password = document.getElementById("newPassword").value;
        const strengthBar = document.getElementById("newPasswordStrengthBar");
        const strengthText = document.getElementById("newPasswordStrengthText");

        if (!password) {
          strengthBar.className = "password-strength-bar";
          strengthText.textContent = "";
          return;
        }

        let strength = 0;

        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        if (strength <= 2) {
          strengthBar.className = "password-strength-bar weak";
          strengthText.textContent = "Mật khẩu yếu";
          strengthText.style.color = "var(--danger-color)";
        } else if (strength <= 4) {
          strengthBar.className = "password-strength-bar medium";
          strengthText.textContent = "Mật khẩu trung bình";
          strengthText.style.color = "var(--warning-color)";
        } else {
          strengthBar.className = "password-strength-bar strong";
          strengthText.textContent = "Mật khẩu mạnh";
          strengthText.style.color = "var(--success-color)";
        }
      }

      /**
       * Close modal
       */
      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("show");
        document.body.style.overflow = "auto";

        // Reset form and alerts
        const modal = document.getElementById(modalId);
        const form = modal.querySelector("form");
        if (form) form.reset();

        const alert = modal.querySelector(".alert");
        if (alert) alert.classList.remove("show");

        // Clear all error messages
        const errorMessages = modal.querySelectorAll(".error-message");
        errorMessages.forEach((msg) => msg.classList.remove("show"));

        // Clear error styling
        const inputs = modal.querySelectorAll("input");
        inputs.forEach((input) => input.classList.remove("error"));

        // Reset password strength bar
        if (modalId === "registerModal") {
          document.getElementById("passwordStrengthBar").className =
            "password-strength-bar";
          document.getElementById("passwordStrengthText").textContent = "";
        }

        // Reset forgot password modal
        if (modalId === "forgotPasswordModal") {
          resetForgotPasswordSteps();
        }
      }

      /**
       * Switch from login to register modal
       */
      function switchToRegister() {
        closeModal("loginModal");
        setTimeout(() => showRegisterModal(), 300);
      }

      /**
       * Switch from register to login modal
       */
      function switchToLogin() {
        closeModal("registerModal");
        setTimeout(() => showLoginModal(), 300);
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        if (event.target.classList.contains("modal")) {
          const modalId = event.target.id;
          closeModal(modalId);
        }
      };

      /**
       * Show alert message
       */
      function showAlert(alertId, message, type = "error") {
        const alert = document.getElementById(alertId);
        const alertMessage = document.getElementById(alertId + "Message");

        alert.className = `alert alert-${type} show`;
        alertMessage.textContent = message;
      }

      /**
       * Hide alert message
       */
      function hideAlert(alertId) {
        const alert = document.getElementById(alertId);
        alert.classList.remove("show");
      }

      /**
       * Show field error message
       */
      function showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const errorDiv = document.getElementById(fieldId + "Error");

        field.classList.add("error");
        errorDiv.textContent = message;
        errorDiv.classList.add("show");
      }

      /**
       * Clear error messages for multiple fields
       */
      function clearErrors(fieldIds) {
        fieldIds.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          const errorDiv = document.getElementById(fieldId + "Error");

          if (field) field.classList.remove("error");
          if (errorDiv) {
            errorDiv.textContent = "";
            errorDiv.classList.remove("show");
          }
        });
      }

      /**
       * Toggle password visibility
       */
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const type =
          input.getAttribute("type") === "password" ? "text" : "password";
        input.setAttribute("type", type);
      }

      /**
       * Check password strength
       */
      function checkPasswordStrength() {
        const password = document.getElementById("registerPassword").value;
        const strengthBar = document.getElementById("passwordStrengthBar");
        const strengthText = document.getElementById("passwordStrengthText");

        if (!password) {
          strengthBar.className = "password-strength-bar";
          strengthText.textContent = "";
          return;
        }

        let strength = 0;

        // Length check
        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;

        // Character variety checks
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        // Update UI based on strength
        if (strength <= 2) {
          strengthBar.className = "password-strength-bar weak";
          strengthText.textContent = "Mật khẩu yếu";
          strengthText.style.color = "var(--danger-color)";
        } else if (strength <= 4) {
          strengthBar.className = "password-strength-bar medium";
          strengthText.textContent = "Mật khẩu trung bình";
          strengthText.style.color = "var(--warning-color)";
        } else {
          strengthBar.className = "password-strength-bar strong";
          strengthText.textContent = "Mật khẩu mạnh";
          strengthText.style.color = "var(--success-color)";
        }
      }

      // ============================================
      // SEARCH FUNCTION
      // ============================================

      function handleBookingSearch(event) {
        event.preventDefault();

        const from = document.getElementById("from").value;
        const to = document.getElementById("to").value;
        const date = document.getElementById("date").value;
        const passengers = document.getElementById("passengers").value;

        // Validation
        if (!from || !to) {
          alert("⚠️ Vui lòng chọn điểm đi và điểm đến!");
          return;
        }

        if (from === to) {
          document.getElementById("sameLocationModal").classList.add("show");
          return;
        }

        // Save search params
        searchParams = {
          from,
          to,
          date,
          passengers: parseInt(passengers),
        };

        // Show loading state
        showLoadingState();

        // Simulate API call delay
        setTimeout(() => {
          performSearch(from, to, date, passengers);
        }, 800);
      }

      function performSearch(from, to, date, passengers) {
        // Create route key (both directions)
        const routeKey1 = `${from}-${to}`;
        const routeKey2 = `${to}-${from}`;

        // Check if route exists
        const routeData =
          routesData[routeKey1] || routesData[routeKey2] || null;

        if (!routeData) {
          showNoResults();
          return;
        }

        // Generate trips for this route
        allTrips = generateTrips(from, to, date, routeData);
        filteredTrips = [...allTrips];

        // Display results
        displayResults();
      }

      function generateTrips(from, to, date, routeData) {
        const trips = [];
        const tripId = Date.now();

        // Generate bus trips
        departureTimes.forEach((time, index) => {
          const availableSeats = Math.floor(Math.random() * 20) + 25;

          trips.push({
            id: `${tripId}-bus-${index}`,
            type: "bus",
            typeName: "Xe khách",
            from: locations[from],
            to: locations[to],
            departureTime: time,
            arrivalTime: calculateArrivalTime(time, routeData.bus.duration),
            date: date,
            price: routeData.bus.price,
            duration: routeData.bus.duration,
            distance: routeData.bus.distance,
            availableSeats: availableSeats,
            totalSeats: 45,
            vehicleNumber: `45B-${Math.floor(Math.random() * 9000) + 1000}`,
            amenities: ["🌡️ Điều hòa", "💺 Ghế ngồi", "📶 WiFi", "🔌 Sạc điện"],
          });
        });

        // Generate limousine trips
        const limoDepartures = ["07:00", "09:00", "13:00", "15:00", "19:00"];
        limoDepartures.forEach((time, index) => {
          const availableSeats = Math.floor(Math.random() * 10) + 10;

          trips.push({
            id: `${tripId}-limo-${index}`,
            type: "limousine",
            typeName: "Limousine",
            from: locations[from],
            to: locations[to],
            departureTime: time,
            arrivalTime: calculateArrivalTime(
              time,
              routeData.limousine.duration
            ),
            date: date,
            price: routeData.limousine.price,
            duration: routeData.limousine.duration,
            distance: routeData.limousine.distance,
            availableSeats: availableSeats,
            totalSeats: 24,
            vehicleNumber: `VIP-${Math.floor(Math.random() * 9000) + 1000}`,
            amenities: [
              "🌡️ Điều hòa",
              "🛋️ Ghế massage",
              "📺 TV",
              "📶 WiFi",
              "🔌 Sạc điện",
              "🍹 Nước uống",
            ],
          });
        });

        trips.sort((a, b) => a.departureTime.localeCompare(b.departureTime));

        return trips;
      }

      function calculateArrivalTime(departureTime, duration) {
        const [hours, minutes] = departureTime.split(":").map(Number);
        const [durationHours, durationMinutes] = duration
          .replace("h", ":")
          .replace("m", "")
          .split(":")
          .map(Number);

        let totalMinutes =
          hours * 60 + minutes + durationHours * 60 + durationMinutes;

        if (totalMinutes >= 1440) {
          totalMinutes -= 1440;
        }

        const arrivalHours = Math.floor(totalMinutes / 60);
        const arrivalMinutes = totalMinutes % 60;

        return `${String(arrivalHours).padStart(2, "0")}:${String(
          arrivalMinutes
        ).padStart(2, "0")}`;
      }

      // ============================================
      // DISPLAY FUNCTIONS
      // ============================================

      function displayResults() {
        hideAllStates();

        // Show results section
        document.getElementById("resultsSection").classList.add("show");

        // Update header
        document.getElementById("routeTitle").textContent = `${
          locations[searchParams.from]
        } → ${locations[searchParams.to]}`;
        document.getElementById("tripCount").textContent = filteredTrips.length;
        document.getElementById("selectedDate").textContent = formatDate(
          searchParams.date
        );

        // Render trip cards
        const tripsGrid = document.getElementById("tripsGrid");
        tripsGrid.innerHTML = "";

        if (filteredTrips.length === 0) {
          showNoResults();
          return;
        }

        filteredTrips.forEach((trip) => {
          tripsGrid.appendChild(createTripCard(trip));
        });

        // Scroll to results
        document.getElementById("resultsSection").scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      function createTripCard(trip) {
        const card = document.createElement("div");
        card.className = "trip-card";
        card.setAttribute("data-type", trip.type);

        const seatStatus =
          trip.availableSeats > 10
            ? "success"
            : trip.availableSeats > 0
            ? "warning"
            : "danger";
        const seatText =
          trip.availableSeats > 0
            ? `Còn ${trip.availableSeats} chỗ`
            : "Hết chỗ";

        card.innerHTML = `
          <div class="trip-header">
            <div class="trip-type ${trip.type}">
              ${trip.type === "bus" ? "🚌" : "✨"} ${trip.typeName}
            </div>
            <div class="trip-price">
              <div class="price-amount">${formatPrice(trip.price)}</div>
              <div class="price-label">VNĐ/khách</div>
            </div>
          </div>

          <div class="trip-route">
            <div class="route-location">
              <div class="location-label">Điểm đi</div>
              <div class="location-name">${trip.from}</div>
            </div>
            <div class="route-arrow">→</div>
            <div class="route-location">
              <div class="location-label">Điểm đến</div>
              <div class="location-name">${trip.to}</div>
            </div>
          </div>

          <div class="trip-details">
            <div class="trip-detail">
              <div class="detail-icon">🕐</div>
              <div class="detail-info">
                <div class="detail-label">Giờ khởi hành</div>
                <div class="detail-value">${trip.departureTime}</div>
              </div>
            </div>
            <div class="trip-detail">
              <div class="detail-icon">🕐</div>
              <div class="detail-info">
                <div class="detail-label">Giờ đến dự kiến</div>
                <div class="detail-value">${trip.arrivalTime}</div>
              </div>
            </div>
            <div class="trip-detail">
              <div class="detail-icon">⏱️</div>
              <div class="detail-info">
                <div class="detail-label">Thời gian</div>
                <div class="detail-value">${trip.duration}</div>
              </div>
            </div>
            <div class="trip-detail">
              <div class="detail-icon">📏</div>
              <div class="detail-info">
                <div class="detail-label">Khoảng cách</div>
                <div class="detail-value">${trip.distance}</div>
              </div>
            </div>
            <div class="trip-detail">
              <div class="detail-icon">💺</div>
              <div class="detail-info">
                <div class="detail-label">Số ghế</div>
                <div class="detail-value">
                  <span class="badge badge-${seatStatus}">${seatText}</span>
                </div>
              </div>
            </div>
            <div class="trip-detail">
              <div class="detail-icon">🚗</div>
              <div class="detail-info">
                <div class="detail-label">Biển số</div>
                <div class="detail-value">${trip.vehicleNumber}</div>
              </div>
            </div>
          </div>

          <div class="trip-actions">
            <button class="btn-book" onclick="bookTrip('${trip.id}')">
              🎫 Đặt vé ngay
            </button>
          </div>
        `;

        return card;
      }

      // ============================================
      // FILTER & SORT FUNCTIONS
      // ============================================

      function filterTrips(filterType) {
        currentFilter = filterType;

        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.getAttribute("data-filter") === filterType) {
            btn.classList.add("active");
          }
        });

        if (filterType === "all") {
          filteredTrips = [...allTrips];
        } else {
          filteredTrips = allTrips.filter((trip) => trip.type === filterType);
        }

        sortTrips();
      }

      function sortTrips() {
        const sortType = document.getElementById("sortSelect").value;

        switch (sortType) {
          case "price-asc":
            filteredTrips.sort((a, b) => a.price - b.price);
            break;
          case "price-desc":
            filteredTrips.sort((a, b) => b.price - a.price);
            break;
          case "time-asc":
            filteredTrips.sort((a, b) =>
              a.departureTime.localeCompare(b.departureTime)
            );
            break;
          case "time-desc":
            filteredTrips.sort((a, b) =>
              b.departureTime.localeCompare(a.departureTime)
            );
            break;
        }

        displayResults();
      }

      // ============================================
      // STATE MANAGEMENT
      // ============================================

      function showLoadingState() {
        hideAllStates();
        document.getElementById("resultsSection").classList.add("show");
        document.getElementById("loadingState").classList.add("show");
      }

      function showNoResults() {
        hideAllStates();
        document.getElementById("resultsSection").classList.add("show");
        document.getElementById("noResultsState").classList.add("show");
      }

      function hideAllStates() {
        document.getElementById("loadingState").classList.remove("show");
        document.getElementById("noResultsState").classList.remove("show");
        document.getElementById("tripsGrid").innerHTML = "";
      }

      // ============================================
      // ACTION HANDLERS
      // ============================================

      let currentBookingTrip = null;
      let selectedSeats = [];
      let occupiedSeats = [];
      let pendingBookingTripId = null;
      let selectedPaymentMethod = "cash"; // Default payment method

      function bookTrip(tripId) {
        const trip = allTrips.find((t) => t.id === tripId);
        if (!trip) return;

        if (trip.availableSeats === 0) {
          alert("⚠️ Xin lỗi, chuyến xe này đã hết chỗ!");
          return;
        }

        // Check if user is logged in
        if (!currentUser) {
          // Store trip ID for later
          pendingBookingTripId = tripId;

          // Show login required modal
          document.getElementById("loginRequiredModal").classList.add("show");
          document.body.style.overflow = "hidden";
          return;
        }

        // Continue with booking
        openBookingModal(trip);
      }

      function openBookingModal(trip) {
        // Set current booking trip
        currentBookingTrip = trip;
        selectedSeats = [];

        // Update modal content
        document.getElementById(
          "bookingModalTitle"
        ).textContent = `Đặt vé ${trip.typeName}`;
        document.getElementById("bookingModalSubtitle").textContent =
          trip.type === "bus"
            ? "Chọn ghế và điền thông tin hành khách"
            : "Điền thông tin hành khách và điểm đón";

        // Update trip summary
        document.getElementById(
          "summaryRoute"
        ).textContent = `${trip.from} → ${trip.to}`;
        document.getElementById("summaryDate").textContent = formatDate(
          trip.date
        );
        document.getElementById("summaryTime").textContent = trip.departureTime;
        document.getElementById("summaryType").textContent = trip.typeName;
        document.getElementById("summaryPrice").textContent = `${formatPrice(
          trip.price
        )} VNĐ`;
        document.getElementById("summaryTotal").textContent = `${formatPrice(
          trip.price
        )} VNĐ`;

        // Pre-fill passenger info if logged in
        if (currentUser) {
          document.getElementById("passengerName").value = currentUser.fullName;
          document.getElementById("passengerPhone").value =
            currentUser.phone || "";
          document.getElementById("passengerEmail").value = currentUser.email;
        }

        // Show/hide pickup location based on vehicle type
        const pickupLocationGroup = document.getElementById(
          "pickupLocationGroup"
        );
        const pickupLocationInput = document.getElementById("pickupLocation");

        if (trip.type === "limousine") {
          pickupLocationGroup.style.display = "block";
          pickupLocationInput.setAttribute("required", "required");
        } else {
          pickupLocationGroup.style.display = "none";
          pickupLocationInput.removeAttribute("required");
          pickupLocationInput.value = "";
        }

        // Show/hide seat selection based on vehicle type
        if (trip.type === "bus") {
          document.getElementById("seatSelectionContainer").style.display =
            "block";
          generateSeats(trip);
        } else {
          document.getElementById("seatSelectionContainer").style.display =
            "none";
        }

        // Show modal
        document.getElementById("bookingModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      function proceedToLogin() {
        // Close login required modal
        closeLoginRequired();

        // Show login modal
        showLoginModal();
      }

      function closeLoginRequired() {
        document.getElementById("loginRequiredModal").classList.remove("show");
        document.body.style.overflow = "auto";
        pendingBookingTripId = null;
      }

      function generateSeats(trip) {
        const seatsGrid = document.getElementById("seatsGrid");
        seatsGrid.innerHTML = "";

        // Generate random occupied seats
        const totalSeats = trip.totalSeats;
        const numOccupied = totalSeats - trip.availableSeats;
        occupiedSeats = [];

        while (occupiedSeats.length < numOccupied) {
          const randomSeat = Math.floor(Math.random() * totalSeats) + 1;
          if (!occupiedSeats.includes(randomSeat)) {
            occupiedSeats.push(randomSeat);
          }
        }

        // Create seat layout (5 columns: 2 + aisle + 2 + 1)
        const rows = Math.ceil(totalSeats / 4); // 4 seats per row (excluding aisle)
        let seatNumber = 1;

        for (let row = 0; row < rows; row++) {
          // Left side (2 seats)
          for (let i = 0; i < 2; i++) {
            if (seatNumber <= totalSeats) {
              const seat = createSeatElement(seatNumber);
              seatsGrid.appendChild(seat);
              seatNumber++;
            }
          }

          // Aisle
          const aisle = document.createElement("div");
          aisle.className = "seat aisle";
          seatsGrid.appendChild(aisle);

          // Right side (2 seats)
          for (let i = 0; i < 2; i++) {
            if (seatNumber <= totalSeats) {
              const seat = createSeatElement(seatNumber);
              seatsGrid.appendChild(seat);
              seatNumber++;
            }
          }
        }

        updateSelectedSeatsDisplay();
      }

      function createSeatElement(seatNumber) {
        const seat = document.createElement("div");
        seat.className = "seat";
        seat.textContent = seatNumber;
        seat.setAttribute("data-seat", seatNumber);

        if (occupiedSeats.includes(seatNumber)) {
          seat.classList.add("occupied");
        } else {
          seat.classList.add("available");
          seat.onclick = () => toggleSeat(seatNumber);
        }

        return seat;
      }

      function toggleSeat(seatNumber) {
        if (occupiedSeats.includes(seatNumber)) return;

        const seatElement = document.querySelector(
          `[data-seat="${seatNumber}"]`
        );

        if (selectedSeats.includes(seatNumber)) {
          // Deselect
          selectedSeats = selectedSeats.filter((s) => s !== seatNumber);
          seatElement.classList.remove("selected");
          seatElement.classList.add("available");
        } else {
          // Check if limit reached
          if (selectedSeats.length >= searchParams.passengers) {
            alert(
              `⚠️ Bạn chỉ có thể chọn tối đa ${searchParams.passengers} ghế (theo số hành khách tìm kiếm)`
            );
            return;
          }

          // Select
          selectedSeats.push(seatNumber);
          seatElement.classList.remove("available");
          seatElement.classList.add("selected");
        }

        updateSelectedSeatsDisplay();
        updateTotalPrice();
      }

      function updateSelectedSeatsDisplay() {
        document.getElementById("selectedSeatsCount").textContent =
          selectedSeats.length;

        // Update confirm button state
        const confirmBtn = document.getElementById("confirmBookingBtn");
        if (currentBookingTrip && currentBookingTrip.type === "bus") {
          if (selectedSeats.length === 0) {
            confirmBtn.disabled = true;
            confirmBtn.textContent = "⚠️ Vui lòng chọn ghế";
          } else {
            confirmBtn.disabled = false;
            confirmBtn.textContent = "💳 Xác nhận đặt vé";
          }
        } else {
          confirmBtn.disabled = false;
          confirmBtn.textContent = "💳 Xác nhận đặt vé";
        }
      }

      function updateTotalPrice() {
        if (!currentBookingTrip) return;

        const numSeats =
          currentBookingTrip.type === "bus"
            ? selectedSeats.length
            : searchParams.passengers;

        const total = currentBookingTrip.price * numSeats;
        document.getElementById("summaryTotal").textContent = `${formatPrice(
          total
        )} VNĐ`;
      }

      // ============================================
      // PAYMENT METHOD FUNCTIONS
      // ============================================

      function selectPaymentMethod(method) {
        selectedPaymentMethod = method;

        // Update UI - only toggle selected state
        document.querySelectorAll(".payment-method").forEach((pm) => {
          pm.classList.remove("selected");
        });
        document.getElementById(`payment-${method}`).classList.add("selected");
      }
      // ============================================
      // BOOKING CONFIRMATION
      // ============================================

      // Bắt đầu hàm confirmBooking
      function confirmBooking() {
        if (!currentBookingTrip) return;

        // Validate seat selection for bus
        if (currentBookingTrip.type === "bus" && selectedSeats.length === 0) {
          alert("⚠️ Vui lòng chọn ít nhất 1 ghế!");
          return;
        }

        // Validate passenger info
        const name = document.getElementById("passengerName").value.trim();
        const phone = document.getElementById("passengerPhone").value.trim();
        const pickupLocation = document
          .getElementById("pickupLocation")
          .value.trim();

        if (!name) {
          alert("⚠️ Vui lòng nhập họ tên!");
          document.getElementById("passengerName").focus();
          return;
        }

        if (!phone) {
          alert("⚠️ Vui lòng nhập số điện thoại!");
          document.getElementById("passengerPhone").focus();
          return;
        }

        // Phone validation
        const phoneRegex = /^(0|\+84)[0-9]{9}$/;
        if (!phoneRegex.test(phone)) {
          alert("⚠️ Số điện thoại không hợp lệ!");
          document.getElementById("passengerPhone").focus();
          return;
        }

        // Validate pickup location for limousine
        if (currentBookingTrip.type === "limousine") {
          if (!pickupLocation) {
            alert("⚠️ Vui lòng nhập điểm đón!");
            document.getElementById("pickupLocation").focus();
            return;
          }

          if (pickupLocation.length < 10) {
            alert("⚠️ Vui lòng nhập địa chỉ đón cụ thể (tối thiểu 10 ký tự)!");
            document.getElementById("pickupLocation").focus();
            return;
          }
        }

        // All validations passed - close booking modal and show review modal
        document.getElementById("bookingModal").classList.remove("show");

        // Wait for booking modal to close, then show review modal
        setTimeout(() => {
          showBookingReviewModal();
        }, 300);
      }

      /**
       * Show booking review modal with all booking details
       */
      function showBookingReviewModal() {
        const name = document.getElementById("passengerName").value.trim();
        const phone = document.getElementById("passengerPhone").value.trim();
        const email = document.getElementById("passengerEmail").value.trim();
        const note = document.getElementById("passengerNote").value.trim();
        const pickupLocation = document.getElementById("pickupLocation").value.trim();

        const numPassengers = currentBookingTrip.type === "bus"
          ? selectedSeats.length
          : searchParams.passengers;
        const totalPrice = currentBookingTrip.price * numPassengers;

        const paymentNames = {
          cash: "Tiền mặt",
          bank: "Chuyển khoản ngân hàng",
          ewallet: "Ví điện tử (MoMo, ZaloPay, VNPay)",
          card: "Thẻ tín dụng/ghi nợ (Visa, Mastercard, JCB)",
        };

        let reviewHTML = `
          <div class="review-section">
            <h3>🚌 Thông tin chuyến xe</h3>
            <div class="review-row">
              <span class="review-label">Tuyến đường</span>
              <span class="review-value">${currentBookingTrip.from} → ${currentBookingTrip.to}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Ngày khởi hành</span>
              <span class="review-value">${currentBookingTrip.date}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Giờ khởi hành</span>
              <span class="review-value">${currentBookingTrip.departureTime}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Loại xe</span>
              <span class="review-value">${currentBookingTrip.typeName}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Biển số xe</span>
              <span class="review-value">${currentBookingTrip.vehicleNumber}</span>
            </div>
        `;

        if (currentBookingTrip.type === "bus") {
          reviewHTML += `
            <div class="review-row">
              <span class="review-label">Số ghế đã chọn</span>
              <span class="review-value">${selectedSeats.join(", ")}</span>
            </div>
          `;
        } else {
          reviewHTML += `
            <div class="review-row">
              <span class="review-label">Số hành khách</span>
              <span class="review-value">${numPassengers} người</span>
            </div>
          `;
        }

        reviewHTML += `</div>`;

        reviewHTML += `
          <div class="review-section">
            <h3>👤 Thông tin hành khách</h3>
            <div class="review-row">
              <span class="review-label">Họ và tên</span>
              <span class="review-value">${name}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Số điện thoại</span>
              <span class="review-value">${phone}</span>
            </div>
        `;

        if (email) {
          reviewHTML += `
            <div class="review-row">
              <span class="review-label">Email</span>
              <span class="review-value">${email}</span>
            </div>
          `;
        }

        if (currentBookingTrip.type === "limousine" && pickupLocation) {
          reviewHTML += `
            <div class="review-row">
              <span class="review-label">Điểm đón</span>
              <span class="review-value">${pickupLocation}</span>
            </div>
          `;
        }

        if (note) {
          reviewHTML += `
            <div class="review-row">
              <span class="review-label">Ghi chú</span>
              <span class="review-value">${note}</span>
            </div>
          `;
        }

        reviewHTML += `</div>`;

        reviewHTML += `
          <div class="review-section">
            <h3>💳 Phương thức thanh toán</h3>
            <div class="review-row">
              <span class="review-label">Phương thức</span>
              <span class="review-value">${paymentNames[selectedPaymentMethod]}</span>
            </div>
          </div>

          <div class="review-total">
            <div class="review-row">
              <span class="review-label">Tổng tiền</span>
              <span class="review-value">${totalPrice.toLocaleString("vi-VN")} VNĐ</span>
            </div>
          </div>
        `;

        document.getElementById("bookingReviewContent").innerHTML = reviewHTML;
        document.getElementById("bookingReviewModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Final confirm booking after review
       */
      function finalConfirmBooking() {
        const name = document.getElementById("passengerName").value.trim();
        const phone = document.getElementById("passengerPhone").value.trim();
        const pickupLocation = document.getElementById("pickupLocation").value.trim();

        // Create booking
        const booking = {
          id: Date.now().toString().slice(-6), // Rút gọn ID cho dễ nhìn
          tripId: currentBookingTrip.id,
          userId: currentUser.email,
          trip: {
            from: currentBookingTrip.from,
            to: currentBookingTrip.to,
            date: currentBookingTrip.date,
            departureTime: currentBookingTrip.departureTime,
            type: currentBookingTrip.typeName,
            vehicleNumber: currentBookingTrip.vehicleNumber,
            price: currentBookingTrip.price,
          },
          passenger: {
            name: name,
            phone: phone,
            email: document.getElementById("passengerEmail").value.trim(),
            note: document.getElementById("passengerNote").value.trim(),
          },
          pickupLocation:
            currentBookingTrip.type === "limousine" ? pickupLocation : null,
          seats: currentBookingTrip.type === "bus" ? selectedSeats : [],
          numPassengers:
            currentBookingTrip.type === "bus"
              ? selectedSeats.length
              : searchParams.passengers,
          totalPrice:
            currentBookingTrip.price *
            (currentBookingTrip.type === "bus"
              ? selectedSeats.length
              : searchParams.passengers),
          paymentMethod: selectedPaymentMethod,
          paymentStatus:
            selectedPaymentMethod === "cash" ? "pending" : "pending",
          status: "confirmed",
          createdAt: new Date().toISOString(),
        };

        // Save booking
        const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        bookings.push(booking);
        localStorage.setItem("bookings", JSON.stringify(bookings));

        // Đóng review modal
        closeModal("bookingReviewModal");

        // Wait for review modal to close, then show success modal
        setTimeout(() => {
          showBookingSuccessModal(booking, currentBookingTrip, pickupLocation);
        }, 300);
      }

      function closeBookingModal() {
        document.getElementById("bookingModal").classList.remove("show");
        document.body.style.overflow = "auto";

        // Reset form
        document.getElementById("passengerForm").reset();
        document.getElementById("pickupLocation").value = "";
        selectedSeats = [];
        occupiedSeats = [];
        currentBookingTrip = null;

        // Reset payment method to default
        selectedPaymentMethod = "cash";
        document.querySelectorAll(".payment-method").forEach((pm) => {
          pm.classList.remove("selected");
        });
        document.getElementById("payment-cash").classList.add("selected");
        document.querySelectorAll(".payment-note").forEach((note) => {
          note.classList.remove("show");
        });
        document.getElementById("payment-cash-note").classList.add("show");
      }
      // ============================================
      // BOOKING SUCCESS MODAL
      // ============================================

      // ============================================
      // BOOKING SUCCESS MODAL FUNCTIONS
      // ============================================

      function showBookingSuccessModal(booking, trip, pickupLocation) {
        const paymentNames = {
          cash: "Tiền mặt",
          bank: "Chuyển khoản ngân hàng",
          ewallet: "Ví điện tử",
          card: "Thẻ tín dụng/ghi nợ",
        };

        const detailsContent = document.getElementById("bookingDetailsContent");
        const notice = document.getElementById("bookingNotice");

        // Build details HTML
        let detailsHTML = `
        <div class="booking-detail-row">
            <span class="booking-detail-label">📋 Mã đặt vé</span>
            <span class="booking-detail-value">${booking.id}</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">📍 Tuyến đường</span>
            <span class="booking-detail-value">${booking.trip.from} → ${
          booking.trip.to
        }</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">🚌 Loại xe</span>
            <span class="booking-detail-value">${booking.trip.type}</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">📅 Ngày khởi hành</span>
            <span class="booking-detail-value">${formatDate(
              booking.trip.date
            )}</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">🕐 Giờ khởi hành</span>
            <span class="booking-detail-value">${
              booking.trip.departureTime
            }</span>
        </div>
    `;

        // Add optional fields
        if (trip.type === "limousine" && pickupLocation) {
          detailsHTML += `
            <div class="booking-detail-row">
                <span class="booking-detail-label">📍 Điểm đón</span>
                <span class="booking-detail-value">${pickupLocation}</span>
            </div>
        `;
        }
        if (trip.type === "bus" && booking.seats.length > 0) {
          detailsHTML += `
            <div class="booking-detail-row">
                <span class="booking-detail-label">🪑 Ghế đã chọn</span>
                <span class="booking-detail-value">${booking.seats
                  .sort((a, b) => a - b)
                  .join(", ")}</span>
            </div>
        `;
        }

        detailsHTML += `
        <div class="booking-detail-row">
            <span class="booking-detail-label">👤 Hành khách</span>
            <span class="booking-detail-value">${booking.passenger.name}</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">📞 Số điện thoại</span>
            <span class="booking-detail-value">${booking.passenger.phone}</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label">💳 Thanh toán</span>
            <span class="booking-detail-value">${
              paymentNames[booking.paymentMethod] || "Tiền mặt"
            }</span>
        </div>
        <div class="booking-detail-row">
            <span class="booking-detail-label" style="font-weight: 700;">💰 Tổng tiền</span>
            <span class="booking-detail-value highlight">${formatPrice(
              booking.totalPrice
            )} VNĐ</span>
        </div>
    `;

        detailsContent.innerHTML = detailsHTML;

        // Set notice based on vehicle type and payment method
        let noticeText = "";
        if (booking.paymentMethod === "bank") {
          noticeText =
            "🏦 Vui lòng **chuyển khoản** số tiền trên. Chi tiết đã được gửi đến email của bạn.";
        } else if (trip.type === "limousine") {
          noticeText =
            "🚗 Tài xế sẽ **liên hệ** trước 30 phút để xác nhận điểm đón. Vui lòng để ý điện thoại!";
        }

        if (noticeText) {
          notice.innerHTML = `<p>${noticeText}</p>`;
        }

        // Show modal
        document.getElementById("bookingSuccessModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      function closeBookingSuccess() {
        document.getElementById("bookingSuccessModal").classList.remove("show");
        document.body.style.overflow = "auto";
      }

      /**
       * View My Bookings - Navigate to My Tickets Section
       */
      function viewMyBookings() {
        if (!currentUser) {
          alert("⚠️ Vui lòng đăng nhập để xem vé của bạn!");
          return;
        }

        closeBookingSuccess();

        // Show my tickets section
        document.getElementById("my-tickets").style.display = "block";

        // Hide other sections
        document.querySelectorAll("section:not(#my-tickets)").forEach(section => {
          if (section.id !== "my-tickets") {
            section.style.display = "none";
          }
        });

        // Scroll to section
        document.getElementById("my-tickets").scrollIntoView({ behavior: "smooth" });

        // Load tickets
        loadMyTickets();
      }

      /**
       * Load My Tickets into the section
       */
      function loadMyTickets() {
        if (!currentUser) return;

        // Get all bookings for current user
        const allBookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const userBookings = allBookings.filter(b => b.userId === currentUser.email);

        // Separate into confirmed, upcoming, completed and cancelled
        const confirmedBookings = userBookings.filter(b => b.status === "confirmed");
        const upcomingBookings = userBookings.filter(b => b.status === "upcoming");
        const completedBookings = userBookings.filter(b => b.status === "completed");
        const cancelledBookings = userBookings.filter(b => b.status === "cancelled");

        // Update counts
        document.getElementById("confirmedCount").textContent = confirmedBookings.length;
        document.getElementById("upcomingCount").textContent = upcomingBookings.length;
        document.getElementById("completedCount").textContent = completedBookings.length;
        document.getElementById("cancelledCount").textContent = cancelledBookings.length;

        // Render confirmed tickets
        const confirmedContent = document.getElementById("confirmedTicketsContent");
        if (confirmedBookings.length === 0) {
          confirmedContent.innerHTML = `
            <div class="empty-tickets">
              <div class="empty-tickets-icon">🎫</div>
              <h3>Chưa có vé nào</h3>
              <p>Bạn chưa có vé đã xác nhận. Hãy tìm kiếm và đặt chuyến đi của bạn!</p>
              <a href="#hero" class="btn-primary" onclick="showAllSections()">Đặt vé ngay</a>
            </div>
          `;
        } else {
          confirmedBookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          confirmedContent.innerHTML = confirmedBookings.map(booking => createTicketCard(booking)).join("");
        }

        // Render upcoming tickets
        const upcomingContent = document.getElementById("upcomingTicketsContent");
        if (upcomingBookings.length === 0) {
          upcomingContent.innerHTML = `
            <div class="empty-tickets">
              <div class="empty-tickets-icon">🚌</div>
              <h3>Không có vé sắp tới</h3>
              <p>Danh sách vé sắp tới sẽ hiển thị ở đây</p>
            </div>
          `;
        } else {
          upcomingBookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          upcomingContent.innerHTML = upcomingBookings.map(booking => createTicketCard(booking)).join("");
        }

        // Render completed tickets
        const completedContent = document.getElementById("completedTicketsContent");
        if (completedBookings.length === 0) {
          completedContent.innerHTML = `
            <div class="empty-tickets">
              <div class="empty-tickets-icon">✅</div>
              <h3>Không có vé đã hoàn thành</h3>
              <p>Danh sách vé đã hoàn thành sẽ hiển thị ở đây</p>
            </div>
          `;
        } else {
          completedBookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          completedContent.innerHTML = completedBookings.map(booking => createTicketCard(booking)).join("");
        }

        // Render cancelled tickets
        const cancelledContent = document.getElementById("cancelledTicketsContent");
        if (cancelledBookings.length === 0) {
          cancelledContent.innerHTML = `
            <div class="empty-tickets">
              <div class="empty-tickets-icon">✓</div>
              <h3>Không có vé đã hủy</h3>
              <p>Danh sách vé đã hủy sẽ hiển thị ở đây</p>
            </div>
          `;
        } else {
          cancelledBookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          cancelledContent.innerHTML = cancelledBookings.map(booking => createTicketCard(booking)).join("");
        }
      }

      /**
       * Create ticket card for section
       */
      function createTicketCard(booking) {
        let statusText = "Đã xác nhận";
        let statusClass = "confirmed";

        if (booking.status === "upcoming") {
          statusText = "Sắp tới";
          statusClass = "upcoming";
        } else if (booking.status === "completed") {
          statusText = "Đã hoàn thành";
          statusClass = "completed";
        } else if (booking.status === "cancelled") {
          statusText = "Đã hủy";
          statusClass = "cancelled";
        }

        let cancelButton = '';
        let trackButton = '';

        // Chỉ vé "confirmed" mới có thể hủy
        if (booking.status === "confirmed") {
          cancelButton = `<button class="ticket-btn-cancel" onclick="cancelTicket('${booking.id}')">🗑️ Hủy vé</button>`;
        }

        // Chỉ vé "upcoming" (sắp tới) mới có nút theo dõi
        if (booking.status === "upcoming") {
          trackButton = `<button class="ticket-btn-track" onclick="trackTicket('${booking.id}')">📍 Theo dõi xe</button>`;
          cancelButton = `<button class="ticket-btn-cancel" onclick="cancelTicket('${booking.id}')">🗑️ Hủy vé</button>`;
        }

        return `
          <div class="ticket-card">
            <div class="ticket-card-header">
              <div>
                <div class="ticket-id">Mã vé: #${booking.id}</div>
                <div class="ticket-date">Đặt ngày: ${new Date(booking.createdAt).toLocaleDateString("vi-VN")}</div>
              </div>
              <span class="booking-status ${statusClass}">${statusText}</span>
            </div>

            <div class="ticket-route">
              <span>${booking.trip.from}</span>
              <span>→</span>
              <span>${booking.trip.to}</span>
            </div>

            <div class="ticket-info-grid">
              <div class="ticket-info-item">
                <span class="ticket-info-label">📅 Ngày khởi hành</span>
                <span class="ticket-info-value">${booking.trip.date}</span>
              </div>
              <div class="ticket-info-item">
                <span class="ticket-info-label">🕐 Giờ khởi hành</span>
                <span class="ticket-info-value">${booking.trip.departureTime}</span>
              </div>
              <div class="ticket-info-item">
                <span class="ticket-info-label">🚌 Loại xe</span>
                <span class="ticket-info-value">${booking.trip.type}</span>
              </div>
              <div class="ticket-info-item">
                <span class="ticket-info-label">👤 Hành khách</span>
                <span class="ticket-info-value">${booking.passenger.name}</span>
              </div>
              ${booking.seats && booking.seats.length > 0 ? `
              <div class="ticket-info-item">
                <span class="ticket-info-label">🪑 Số ghế</span>
                <span class="ticket-info-value">${booking.seats.join(", ")}</span>
              </div>
              ` : ''}
            </div>

            <div class="ticket-price">
              <span class="ticket-price-label">Tổng tiền</span>
              <span class="ticket-price-value">${booking.totalPrice.toLocaleString("vi-VN")} VNĐ</span>
            </div>

            <div class="ticket-actions">
              <button class="ticket-btn-detail" onclick="viewTicketDetail('${booking.id}')">
                📋 Xem chi tiết
              </button>
              ${trackButton}
              ${cancelButton}
            </div>
          </div>
        `;
      }

      /**
       * Show ticket tab
       */
      function showTicketTab(tab) {
        const tabs = document.querySelectorAll(".ticket-tab");
        tabs.forEach(t => t.classList.remove("active"));

        // Hide all tabs
        document.getElementById("confirmedTicketsContent").style.display = "none";
        document.getElementById("upcomingTicketsContent").style.display = "none";
        document.getElementById("completedTicketsContent").style.display = "none";
        document.getElementById("cancelledTicketsContent").style.display = "none";

        if (tab === "confirmed") {
          document.getElementById("confirmedTicketsTabBtn").classList.add("active");
          document.getElementById("confirmedTicketsContent").style.display = "grid";
        } else if (tab === "upcoming") {
          document.getElementById("upcomingTicketsTabBtn").classList.add("active");
          document.getElementById("upcomingTicketsContent").style.display = "grid";
        } else if (tab === "completed") {
          document.getElementById("completedTicketsTabBtn").classList.add("active");
          document.getElementById("completedTicketsContent").style.display = "grid";
        } else {
          document.getElementById("cancelledTicketsTabBtn").classList.add("active");
          document.getElementById("cancelledTicketsContent").style.display = "grid";
        }
      }

      /**
       * View ticket detail (reuse modal)
       */
      function viewTicketDetail(bookingId) {
        viewBookingDetail(bookingId);
      }

      /**
       * Track ticket in realtime
       */
      function trackTicket(bookingId) {
        // Open realtime tracking page
        window.open(`realtime.html?ticketId=${bookingId}`, '_blank');
      }

      /**
       * Cancel ticket - Show confirmation modal
       */
      let pendingCancelBookingId = null;

      function cancelTicket(bookingId) {
        const allBookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const booking = allBookings.find(b => b.id === bookingId);

        if (!booking) {
          alert("⚠️ Không tìm thấy vé!");
          return;
        }

        // Check if can cancel (24 hours before departure)
        const canCancel = canCancelBooking(booking);

        if (!canCancel.allowed) {
          // Show cannot cancel modal with ticket info
          const cannotCancelInfo = document.getElementById("cannotCancelTicketInfo");
          cannotCancelInfo.innerHTML = `
            <div class="cancel-info-row">
              <span class="cancel-info-label">Mã vé</span>
              <span class="cancel-info-value">#${booking.id}</span>
            </div>
            <div class="cancel-info-row">
              <span class="cancel-info-label">Tuyến đường</span>
              <span class="cancel-info-value">${booking.trip.from} → ${booking.trip.to}</span>
            </div>
            <div class="cancel-info-row">
              <span class="cancel-info-label">Ngày khởi hành</span>
              <span class="cancel-info-value">${booking.trip.date} - ${booking.trip.departureTime}</span>
            </div>
            <div class="cancel-info-row">
              <span class="cancel-info-label">Tổng tiền</span>
              <span class="cancel-info-value">${booking.totalPrice.toLocaleString("vi-VN")} VNĐ</span>
            </div>
          `;

          document.getElementById("cannotCancelModal").classList.add("show");
          return;
        }

        // Store booking id for later confirmation
        pendingCancelBookingId = bookingId;

        // Show ticket info in modal
        const cancelInfo = document.getElementById("cancelTicketInfo");
        cancelInfo.innerHTML = `
          <div class="cancel-info-row">
            <span class="cancel-info-label">Mã vé</span>
            <span class="cancel-info-value">#${booking.id}</span>
          </div>
          <div class="cancel-info-row">
            <span class="cancel-info-label">Tuyến đường</span>
            <span class="cancel-info-value">${booking.trip.from} → ${booking.trip.to}</span>
          </div>
          <div class="cancel-info-row">
            <span class="cancel-info-label">Ngày khởi hành</span>
            <span class="cancel-info-value">${booking.trip.date} - ${booking.trip.departureTime}</span>
          </div>
          <div class="cancel-info-row">
            <span class="cancel-info-label">Tổng tiền</span>
            <span class="cancel-info-value">${booking.totalPrice.toLocaleString("vi-VN")} VNĐ</span>
          </div>
        `;

        // Show modal
        document.getElementById("cancelConfirmModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Check if booking can be cancelled (24 hours before departure)
       */
      function canCancelBooking(booking) {
        try {
          // Parse date and time
          const dateParts = booking.trip.date.split("/");
          const timeParts = booking.trip.departureTime.split(":");

          // Create departure datetime (DD/MM/YYYY -> YYYY-MM-DD)
          const departureDate = new Date(
            parseInt(dateParts[2]), // year
            parseInt(dateParts[1]) - 1, // month (0-indexed)
            parseInt(dateParts[0]), // day
            parseInt(timeParts[0]), // hours
            parseInt(timeParts[1]) // minutes
          );

          const now = new Date();
          const hoursDiff = (departureDate - now) / (1000 * 60 * 60);

          if (hoursDiff < 24) {
            return {
              allowed: false,
              message: "Chỉ có thể hủy vé trước 24 giờ so với giờ khởi hành. Vui lòng liên hệ hotline để được hỗ trợ."
            };
          }

          return { allowed: true };
        } catch (error) {
          console.error("Error checking cancel time:", error);
          return {
            allowed: false,
            message: "Không thể xác định thời gian khởi hành. Vui lòng liên hệ hotline."
          };
        }
      }

      /**
       * Confirm cancel ticket
       */
      function confirmCancelTicket() {
        if (!pendingCancelBookingId) return;

        const allBookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const bookingIndex = allBookings.findIndex(b => b.id === pendingCancelBookingId);

        if (bookingIndex === -1) {
          alert("⚠️ Không tìm thấy vé!");
          closeModal("cancelConfirmModal");
          return;
        }

        // Update booking status
        allBookings[bookingIndex].status = "cancelled";
        allBookings[bookingIndex].cancelledAt = new Date().toISOString();
        localStorage.setItem("bookings", JSON.stringify(allBookings));

        // Close modal
        closeModal("cancelConfirmModal");

        // Show success message
        setTimeout(() => {
          document.getElementById("cancelSuccessModal").classList.add("show");
        }, 300);
      }

      /**
       * Close cancel success modal and reload tickets
       */
      function closeCancelSuccess() {
        closeModal("cancelSuccessModal");

        // Reload tickets
        loadMyTickets();

        // Reset pending id
        pendingCancelBookingId = null;
      }

      /**
       * Create demo bookings for testing cancel functionality
       */
      function createDemoBookings() {
        if (!currentUser) {
          alert("⚠️ Vui lòng đăng nhập trước khi tạo demo!");
          showLoginModal();
          return;
        }

        const now = new Date();

        // Booking 1: Có thể hủy (còn 48 giờ)
        const futureDate1 = new Date(now.getTime() + 48 * 60 * 60 * 1000); // +48 hours
        const booking1 = {
          id: "DEMO" + Date.now() + "001",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Hải Phòng",
            date: formatDate(futureDate1),
            departureTime: "08:00",
            arrivalTime: "10:30",
            type: "Xe Limousine",
            price: 250000
          },
          passenger: {
            name: "Nguyễn Văn A",
            phone: "0123456789",
            email: "nguyenvana@example.com"
          },
          pickupLocation: "Bến xe Mỹ Đình",
          paymentMethod: "cash",
          totalPrice: 250000,
          createdAt: new Date().toISOString(),
          status: "confirmed"
        };

        // Booking 2: KHÔNG thể hủy (còn 12 giờ - trong vòng 24h)
        const futureDate2 = new Date(now.getTime() + 12 * 60 * 60 * 1000); // +12 hours
        const booking2 = {
          id: "DEMO" + Date.now() + "002",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Thanh Hóa",
            date: formatDate(futureDate2),
            departureTime: formatTime(futureDate2),
            arrivalTime: "14:30",
            type: "Xe Khách",
            price: 180000
          },
          passenger: {
            name: "Trần Thị B",
            phone: "0987654321",
            email: "tranthib@example.com"
          },
          pickupLocation: "Bến xe Giáp Bát",
          paymentMethod: "momo",
          totalPrice: 180000,
          createdAt: new Date().toISOString(),
          status: "confirmed"
        };

        // Booking 3: Đã hoàn thành (để test tab "Đã hoàn thành")
        const pastDate1 = new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000); // -2 days
        const booking3 = {
          id: "DEMO" + Date.now() + "003",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Nghệ An",
            date: formatDate(pastDate1),
            departureTime: "15:00",
            arrivalTime: "20:00",
            type: "Xe Limousine",
            price: 350000
          },
          passenger: {
            name: "Lê Văn C",
            phone: "0912345678",
            email: "levanc@example.com"
          },
          pickupLocation: "Bến xe Nước Ngầm",
          paymentMethod: "bank",
          totalPrice: 350000,
          createdAt: new Date(now.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString(),
          status: "completed",
          completedAt: new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString()
        };

        // Booking 4: Sắp tới (UPCOMING - có nút theo dõi)
        const futureDate3 = new Date(now.getTime() + 6 * 60 * 60 * 1000); // +6 hours
        const booking4 = {
          id: "DEMO" + Date.now() + "004",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Đà Nẵng",
            date: formatDate(futureDate3),
            departureTime: formatTime(futureDate3),
            arrivalTime: "22:00",
            type: "Xe Limousine",
            price: 450000
          },
          passenger: {
            name: "Lê Thị E",
            phone: "0911223344",
            email: "lethie@example.com"
          },
          pickupLocation: "Bến xe Nước Ngầm",
          paymentMethod: "bank",
          totalPrice: 450000,
          createdAt: new Date().toISOString(),
          status: "upcoming"
        };

        // Booking 5: Đã hủy (để test tab "Đã hủy")
        const pastDate2 = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000); // -7 days
        const booking5 = {
          id: "DEMO" + Date.now() + "005",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Hà Tĩnh",
            date: formatDate(pastDate2),
            departureTime: "09:00",
            arrivalTime: "14:00",
            type: "Xe Khách",
            price: 220000
          },
          passenger: {
            name: "Phạm Thị D",
            phone: "0909123456",
            email: "phamthid@example.com"
          },
          pickupLocation: "Bến xe Mỹ Đình",
          paymentMethod: "cash",
          totalPrice: 220000,
          createdAt: new Date(now.getTime() - 10 * 24 * 60 * 60 * 1000).toISOString(),
          status: "cancelled",
          cancelledAt: new Date(now.getTime() - 8 * 24 * 60 * 60 * 1000).toISOString()
        };

        // Booking 6: Sắp tới - Xe Khách (UPCOMING - có nút theo dõi)
        const futureDate4 = new Date(now.getTime() + 4 * 60 * 60 * 1000); // +4 hours
        const booking6 = {
          id: "DEMO" + Date.now() + "006",
          userId: currentUser.email,
          trip: {
            from: "Hà Nội",
            to: "Hải Phòng",
            date: formatDate(futureDate4),
            departureTime: formatTime(futureDate4),
            arrivalTime: "16:30",
            type: "Xe Khách",
            price: 130000
          },
          passenger: {
            name: "Nguyễn Văn F",
            phone: "0933445566",
            email: "nguyenvanf@example.com"
          },
          pickupLocation: "Bến xe Mỹ Đình",
          paymentMethod: "bank",
          totalPrice: 130000,
          createdAt: new Date().toISOString(),
          status: "upcoming"
        };

        // Save to localStorage
        const existingBookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const newBookings = [...existingBookings, booking1, booking2, booking3, booking4, booking5, booking6];
        localStorage.setItem("bookings", JSON.stringify(newBookings));

        alert(`✓ Đã tạo 6 vé demo:\n\n1. Vé Hà Nội → Hải Phòng (ĐÃ XÁC NHẬN - còn 48 giờ)\n2. Vé Hà Nội → Thanh Hóa (ĐÃ XÁC NHẬN - còn 12 giờ)\n3. Vé Hà Nội → Nghệ An (ĐÃ HOÀN THÀNH)\n4. Vé Hà Nội → Đà Nẵng Limousine (SẮP TỚI - có theo dõi)\n5. Vé Hà Nội → Hà Tĩnh (ĐÃ HỦY)\n6. Vé Hà Nội → Hải Phòng Xe Khách (SẮP TỚI - có theo dõi)`);

        // Navigate to My Tickets
        navigateToMyTickets();
      }

      /**
       * Format date to DD/MM/YYYY
       */
      function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      /**
       * Format time to HH:MM
       */
      function formatTime(date) {
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
      }

      /**
       * Show all sections (navigate back to home)
       */
      function showAllSections() {
        document.getElementById("my-tickets").style.display = "none";
        document.querySelectorAll("section:not(#my-tickets)").forEach(section => {
          section.style.display = "block";
        });
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      /**
       * Navigate to My Tickets section from menu
       */
      function navigateToMyTickets() {
        if (!currentUser) {
          alert("⚠️ Vui lòng đăng nhập để xem vé của bạn!");
          showLoginModal();
          return;
        }

        // Show my tickets section
        document.getElementById("my-tickets").style.display = "block";

        // Hide other sections
        document.querySelectorAll("section:not(#my-tickets)").forEach(section => {
          if (section.id !== "my-tickets") {
            section.style.display = "none";
          }
        });

        // Scroll to top
        window.scrollTo({ top: 0, behavior: "smooth" });

        // Load tickets
        loadMyTickets();
      }

      /**
       * Create booking card HTML
       */
      function createBookingCard(booking) {
        const statusText = booking.status === "confirmed" ? "Đã xác nhận" : "Đã hủy";
        const statusClass = booking.status === "confirmed" ? "confirmed" : "cancelled";

        const paymentNames = {
          cash: "Tiền mặt",
          bank: "Chuyển khoản",
          ewallet: "Ví điện tử",
          card: "Thẻ tín dụng/ghi nợ"
        };

        let cancelButton = '';
        if (booking.status === "confirmed") {
          cancelButton = `<button class="btn-cancel" onclick="cancelBooking('${booking.id}')">🗑️ Hủy vé</button>`;
        }

        return `
          <div class="booking-card">
            <div class="booking-card-header">
              <div>
                <div class="booking-id">Mã vé: #${booking.id}</div>
                <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">
                  Đặt ngày: ${new Date(booking.createdAt).toLocaleDateString("vi-VN")}
                </div>
              </div>
              <span class="booking-status ${statusClass}">${statusText}</span>
            </div>

            <div class="booking-route">${booking.trip.from} → ${booking.trip.to}</div>

            <div class="booking-card-body">
              <div class="booking-info-item">
                <span class="booking-info-label">📅 Ngày khởi hành</span>
                <span class="booking-info-value">${booking.trip.date}</span>
              </div>
              <div class="booking-info-item">
                <span class="booking-info-label">🕐 Giờ khởi hành</span>
                <span class="booking-info-value">${booking.trip.departureTime}</span>
              </div>
              <div class="booking-info-item">
                <span class="booking-info-label">🚌 Loại xe</span>
                <span class="booking-info-value">${booking.trip.type}</span>
              </div>
              <div class="booking-info-item">
                <span class="booking-info-label">👤 Hành khách</span>
                <span class="booking-info-value">${booking.passenger.name}</span>
              </div>
              ${booking.seats && booking.seats.length > 0 ? `
              <div class="booking-info-item">
                <span class="booking-info-label">🪑 Ghế</span>
                <span class="booking-info-value">${booking.seats.join(", ")}</span>
              </div>
              ` : ''}
              <div class="booking-info-item">
                <span class="booking-info-label">💰 Tổng tiền</span>
                <span class="booking-info-value" style="color: var(--primary-color);">
                  ${booking.totalPrice.toLocaleString("vi-VN")} VNĐ
                </span>
              </div>
            </div>

            <div class="booking-card-footer">
              <button class="btn-detail" onclick="viewBookingDetail('${booking.id}')">
                📋 Xem chi tiết
              </button>
              ${cancelButton}
            </div>
          </div>
        `;
      }

      /**
       * Show booking tab
       */
      function showBookingTab(tab) {
        const tabs = document.querySelectorAll(".booking-tab");
        tabs.forEach(t => t.classList.remove("active"));

        if (tab === "active") {
          tabs[0].classList.add("active");
          document.getElementById("activeBookingsTab").style.display = "block";
          document.getElementById("cancelledBookingsTab").style.display = "none";
        } else {
          tabs[1].classList.add("active");
          document.getElementById("activeBookingsTab").style.display = "none";
          document.getElementById("cancelledBookingsTab").style.display = "block";
        }
      }

      /**
       * View booking detail
       */
      function viewBookingDetail(bookingId) {
        const allBookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const booking = allBookings.find(b => b.id === bookingId);

        if (!booking) {
          alert("⚠️ Không tìm thấy vé!");
          return;
        }

        const paymentNames = {
          cash: "Tiền mặt",
          bank: "Chuyển khoản ngân hàng",
          ewallet: "Ví điện tử",
          card: "Thẻ tín dụng/ghi nợ"
        };

        const statusText = booking.status === "confirmed" ? "Đã xác nhận" : "Đã hủy";
        const statusClass = booking.status === "confirmed" ? "confirmed" : "cancelled";

        let detailHTML = `
          <div class="review-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3>📋 Mã vé: #${booking.id}</h3>
              <span class="booking-status ${statusClass}">${statusText}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Ngày đặt</span>
              <span class="review-value">${new Date(booking.createdAt).toLocaleString("vi-VN")}</span>
            </div>
          </div>

          <div class="review-section">
            <h3>🚌 Thông tin chuyến xe</h3>
            <div class="review-row">
              <span class="review-label">Tuyến đường</span>
              <span class="review-value">${booking.trip.from} → ${booking.trip.to}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Ngày khởi hành</span>
              <span class="review-value">${booking.trip.date}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Giờ khởi hành</span>
              <span class="review-value">${booking.trip.departureTime}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Loại xe</span>
              <span class="review-value">${booking.trip.type}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Biển số xe</span>
              <span class="review-value">${booking.trip.vehicleNumber}</span>
            </div>
        `;

        if (booking.seats && booking.seats.length > 0) {
          detailHTML += `
            <div class="review-row">
              <span class="review-label">Số ghế</span>
              <span class="review-value">${booking.seats.join(", ")}</span>
            </div>
          `;
        }

        detailHTML += `</div>`;

        detailHTML += `
          <div class="review-section">
            <h3>👤 Thông tin hành khách</h3>
            <div class="review-row">
              <span class="review-label">Họ và tên</span>
              <span class="review-value">${booking.passenger.name}</span>
            </div>
            <div class="review-row">
              <span class="review-label">Số điện thoại</span>
              <span class="review-value">${booking.passenger.phone}</span>
            </div>
        `;

        if (booking.passenger.email) {
          detailHTML += `
            <div class="review-row">
              <span class="review-label">Email</span>
              <span class="review-value">${booking.passenger.email}</span>
            </div>
          `;
        }

        if (booking.pickupLocation) {
          detailHTML += `
            <div class="review-row">
              <span class="review-label">Điểm đón</span>
              <span class="review-value">${booking.pickupLocation}</span>
            </div>
          `;
        }

        if (booking.passenger.note) {
          detailHTML += `
            <div class="review-row">
              <span class="review-label">Ghi chú</span>
              <span class="review-value">${booking.passenger.note}</span>
            </div>
          `;
        }

        detailHTML += `</div>`;

        detailHTML += `
          <div class="review-section">
            <h3>💳 Thanh toán</h3>
            <div class="review-row">
              <span class="review-label">Phương thức</span>
              <span class="review-value">${paymentNames[booking.paymentMethod]}</span>
            </div>
          </div>

          <div class="review-total">
            <div class="review-row">
              <span class="review-label">Tổng tiền</span>
              <span class="review-value">${booking.totalPrice.toLocaleString("vi-VN")} VNĐ</span>
            </div>
          </div>

          <div class="qr-code-section">
            <h3>📱 Mã QR vé</h3>
            <p class="qr-description">Xuất trình mã này khi lên xe</p>
            <div id="qrcode" class="qr-code-container"></div>
            <p class="booking-id-text">Mã vé: <strong>${booking.id}</strong></p>
          </div>
        `;

        document.getElementById("bookingDetailContent").innerHTML = detailHTML;

        // Generate QR Code
        setTimeout(() => {
          const qrContainer = document.getElementById("qrcode");
          if (qrContainer) {
            qrContainer.innerHTML = ""; // Clear previous QR code
            new QRCode(qrContainer, {
              text: JSON.stringify({
                id: booking.id,
                passenger: booking.passenger.name,
                from: booking.trip.from,
                to: booking.trip.to,
                date: booking.trip.date,
                time: booking.trip.departureTime
              }),
              width: 200,
              height: 200,
              colorDark: "#2563eb",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
          }
        }, 100);

        document.getElementById("bookingDetailModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Cancel booking
       */
      function cancelBooking(bookingId) {
        // Use the same logic as cancelTicket
        cancelTicket(bookingId);
      }

      // ============================================
      // UTILITY FUNCTIONS
      // ============================================

      function formatPrice(price) {
        return price.toLocaleString("vi-VN");
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      function toggleMobileMenu() {
        const nav = document.getElementById("mainNav");
        nav.classList.toggle("show");
      }

      // Smooth scroll
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        });
      });

      // ============================================
      // ACCOUNT SETTINGS FUNCTIONS
      // ============================================

      /**
       * Navigate to Account Settings page
       */
      function navigateToAccountSettings() {
        // Hide all sections
        document.querySelectorAll("section").forEach(section => {
          section.style.display = "none";
        });

        // Show account settings section
        document.getElementById("account-settings").style.display = "block";

        // Load user data
        loadAccountSettings();

        // Scroll to top
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      /**
       * Load account settings with current user data
       */
      function loadAccountSettings() {
        if (!currentUser) {
          navigateToHome();
          return;
        }

        // Load user data from localStorage
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const user = users.find(u => u.email === currentUser.email);

        if (user) {
          document.getElementById("profileFullName").value = user.fullName;
          document.getElementById("profileEmail").value = user.email;
          document.getElementById("profilePhone").value = user.phone;

          // Display last login time
          if (currentUser.loginTime) {
            const loginDate = new Date(currentUser.loginTime);
            document.getElementById("lastLoginTime").textContent =
              loginDate.toLocaleString('vi-VN');
          }
        }
      }

      /**
       * Toggle edit mode for profile
       */
      function toggleEditProfile() {
        const inputs = ["profileFullName", "profileEmail", "profilePhone"];
        const editBtn = document.getElementById("editProfileBtn");
        const formActions = document.getElementById("profileFormActions");

        const isDisabled = document.getElementById("profileFullName").disabled;

        if (isDisabled) {
          // Enable edit mode
          inputs.forEach(id => {
            document.getElementById(id).disabled = false;
          });
          editBtn.textContent = "❌ Hủy chỉnh sửa";
          formActions.style.display = "flex";
        } else {
          // Cancel edit mode
          cancelEditProfile();
        }
      }

      /**
       * Cancel edit profile
       */
      function cancelEditProfile() {
        const inputs = ["profileFullName", "profileEmail", "profilePhone"];
        const editBtn = document.getElementById("editProfileBtn");
        const formActions = document.getElementById("profileFormActions");

        inputs.forEach(id => {
          document.getElementById(id).disabled = true;
        });
        editBtn.textContent = "✏️ Chỉnh sửa";
        formActions.style.display = "none";

        // Reload original data
        loadAccountSettings();

        // Hide alerts and clear errors
        hideAlert("profileAlert");
        clearErrors(["profileFullName", "profileEmail", "profilePhone"]);
      }

      /**
       * Handle profile form submission
       */
      document.getElementById("profileForm").addEventListener("submit", function(e) {
        e.preventDefault();

        hideAlert("profileAlert");
        clearErrors(["profileFullName", "profileEmail", "profilePhone"]);

        const fullName = document.getElementById("profileFullName").value.trim();
        const email = document.getElementById("profileEmail").value.trim();
        const phone = document.getElementById("profilePhone").value.trim();

        // Validation
        let hasError = false;

        if (!fullName || fullName.length < 2) {
          showFieldError("profileFullName", "Họ tên phải có ít nhất 2 ký tự");
          hasError = true;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
          showFieldError("profileEmail", "Email không hợp lệ");
          hasError = true;
        }

        const phoneRegex = /^(0|\+84)[0-9]{9}$/;
        if (!phone || !phoneRegex.test(phone)) {
          showFieldError("profilePhone", "Số điện thoại không hợp lệ (VD: 0912345678)");
          hasError = true;
        }

        if (hasError) return;

        // Check if email/phone already exists (for other users)
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        const emailExists = users.some(u => u.email === email && u.email !== currentUser.email);
        if (emailExists) {
          showAlert("profileAlert", "Email đã được sử dụng bởi tài khoản khác!", "error");
          return;
        }

        const phoneExists = users.some(u => u.phone === phone && u.email !== currentUser.email);
        if (phoneExists) {
          showAlert("profileAlert", "Số điện thoại đã được sử dụng bởi tài khoản khác!", "error");
          return;
        }

        // Update user data
        const userIndex = users.findIndex(u => u.email === currentUser.email);
        if (userIndex !== -1) {
          users[userIndex].fullName = fullName;
          users[userIndex].email = email;
          users[userIndex].phone = phone;

          localStorage.setItem("users", JSON.stringify(users));

          // Update currentUser
          currentUser.fullName = fullName;
          currentUser.email = email;
          currentUser.phone = phone;

          showAlert("profileAlert", "Cập nhật thông tin thành công!", "success");

          // Disable edit mode after 1.5s
          setTimeout(() => {
            cancelEditProfile();
            updateUIForLoggedInUser();
          }, 1500);
        }
      });

      /**
       * Show delete account confirmation
       */
      function showDeleteAccountConfirm() {
        const confirm = window.confirm(
          "⚠️ BẠN CHẮC CHẮN MUỐN XÓA TÀI KHOẢN?\n\n" +
          "Hành động này không thể hoàn tác. Tất cả dữ liệu của bạn sẽ bị xóa vĩnh viễn.\n\n" +
          "Nhấn OK để xác nhận xóa tài khoản."
        );

        if (confirm) {
          deleteAccount();
        }
      }

      /**
       * Delete user account
       */
      function deleteAccount() {
        if (!currentUser) return;

        // Remove user from users array
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const filteredUsers = users.filter(u => u.email !== currentUser.email);
        localStorage.setItem("users", JSON.stringify(filteredUsers));

        // Remove user's bookings
        const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
        const filteredBookings = bookings.filter(b => b.userId !== currentUser.email);
        localStorage.setItem("bookings", JSON.stringify(filteredBookings));

        // Logout
        alert("✓ Tài khoản đã được xóa thành công!");
        handleLogout();
      }

      // ============================================
      // SETTINGS DROPDOWN FUNCTIONS
      // ============================================

      /**
       * Toggle settings dropdown menu
       */
      function toggleSettingsDropdown() {
        const dropdown = document.getElementById('settingsDropdown');
        dropdown.classList.toggle('show');
      }

      /**
       * Close dropdown when clicking outside
       */
      document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('settingsDropdown');
        const settingsBtn = document.querySelector('.account-settings-btn');

        if (dropdown && settingsBtn && !settingsBtn.contains(event.target)) {
          dropdown.classList.remove('show');
        }
      });

      /**
       * Show Update Profile Modal
       */
      function showUpdateProfileModal() {
        if (!currentUser) {
          navigateToHome();
          return;
        }

        // Close dropdown
        const dropdown = document.getElementById('settingsDropdown');
        if (dropdown) {
          dropdown.classList.remove('show');
        }

        // Load current user data
        const users = JSON.parse(localStorage.getItem("users") || "[]");
        const user = users.find(u => u.email === currentUser.email);

        if (user) {
          document.getElementById("updateFullName").value = user.fullName;
          document.getElementById("updateEmail").value = user.email;
          document.getElementById("updatePhone").value = user.phone;
        }

        // Clear any previous errors
        hideAlert("updateProfileAlert");
        clearErrors(["updateFullName", "updateEmail", "updatePhone"]);

        // Show modal
        document.getElementById("updateProfileModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      /**
       * Handle Update Profile Form Submission
       */
      function handleUpdateProfile(event) {
        event.preventDefault();

        hideAlert("updateProfileAlert");
        clearErrors(["updateFullName", "updateEmail", "updatePhone"]);

        const fullName = document.getElementById("updateFullName").value.trim();
        const email = document.getElementById("updateEmail").value.trim();
        const phone = document.getElementById("updatePhone").value.trim();

        // Validation
        let hasError = false;

        if (!fullName || fullName.length < 2) {
          showFieldError("updateFullName", "Họ tên phải có ít nhất 2 ký tự");
          hasError = true;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
          showFieldError("updateEmail", "Email không hợp lệ");
          hasError = true;
        }

        const phoneRegex = /^(0|\+84)[0-9]{9}$/;
        if (!phone || !phoneRegex.test(phone)) {
          showFieldError("updatePhone", "Số điện thoại không hợp lệ (VD: 0912345678)");
          hasError = true;
        }

        if (hasError) return;

        // Check if email/phone already exists (for other users)
        const users = JSON.parse(localStorage.getItem("users") || "[]");

        const emailExists = users.some(u => u.email === email && u.email !== currentUser.email);
        if (emailExists) {
          showAlert("updateProfileAlert", "Email đã được sử dụng bởi tài khoản khác!", "error");
          return;
        }

        const phoneExists = users.some(u => u.phone === phone && u.email !== currentUser.email);
        if (phoneExists) {
          showAlert("updateProfileAlert", "Số điện thoại đã được sử dụng bởi tài khoản khác!", "error");
          return;
        }

        // Update user data
        const userIndex = users.findIndex(u => u.email === currentUser.email);
        if (userIndex !== -1) {
          users[userIndex].fullName = fullName;
          users[userIndex].email = email;
          users[userIndex].phone = phone;

          localStorage.setItem("users", JSON.stringify(users));

          // Update currentUser
          currentUser.fullName = fullName;
          currentUser.email = email;
          currentUser.phone = phone;

          // Close modal
          closeModal('updateProfileModal');

          // Show success popup
          showSuccessPopup('✓ Cập nhật thông tin thành công!');

          // Update UI
          updateUIForLoggedInUser();
        }
      }

      /**
       * Show success popup notification
       */
      function showSuccessPopup(message) {
        // Create popup element
        const popup = document.createElement('div');
        popup.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 40px 50px;
          border-radius: 20px;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
          z-index: 10001;
          text-align: center;
          min-width: 400px;
          max-width: 90%;
          animation: scaleIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        `;

        popup.innerHTML = `
          <div style="
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 42px;
            color: white;
            animation: bounceIn 0.6s ease;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
          ">✓</div>
          <div style="
            font-size: 20px;
            color: var(--gray-900);
            font-weight: 700;
            line-height: 1.5;
            margin-bottom: 8px;
          ">
            ${message}
          </div>
          <div style="
            font-size: 14px;
            color: var(--gray-600);
          ">
            Thông tin đã được lưu thành công
          </div>
        `;

        // Create overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 10000;
          animation: fadeIn 0.3s ease-out;
          backdrop-filter: blur(2px);
        `;

        // Add to page
        document.body.appendChild(overlay);
        document.body.appendChild(popup);

        // Auto remove after 2 seconds
        setTimeout(() => {
          popup.style.animation = 'scaleOut 0.3s ease-in';
          overlay.style.animation = 'fadeOut 0.3s ease-in';
          setTimeout(() => {
            document.body.removeChild(popup);
            document.body.removeChild(overlay);
          }, 300);
        }, 2000);
      }

      console.log("🚌 Thăng Long Express - Website hoàn chỉnh!");
      console.log("✅ Hero + Booking + Search + Features + Auth + Account Settings!");
    </script>
  </body>
</html>
